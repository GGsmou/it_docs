<!DOCTYPE html><html lang="en" dir="ltr" data-has-toc data-has-sidebar data-theme="dark" class="astro-bguv2lll"> <head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>NodeJS | IT Docs</title><link rel="canonical"/><link rel="shortcut icon" href="/it_docs/favicon.svg" type="image/svg+xml"/><meta name="generator" content="Astro v4.4.4"/><meta name="generator" content="Starlight v0.19.1"/><meta property="og:title" content="NodeJS"/><meta property="og:type" content="article"/><meta property="og:url"/><meta property="og:locale" content="en"/><meta property="og:description"/><meta property="og:site_name" content="IT Docs"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="NodeJS"/><meta name="twitter:description"/><script>
	window.StarlightThemeProvider = (() => {
		const storedTheme =
			typeof localStorage !== 'undefined' && localStorage.getItem('starlight-theme');
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
		document.documentElement.dataset.theme = theme === 'light' ? 'light' : 'dark';
		return {
			updatePickers(theme = storedTheme || 'auto') {
				document.querySelectorAll('starlight-theme-select').forEach((picker) => {
					const select = picker.querySelector('select');
					if (select) select.value = theme;
					/** @type {HTMLTemplateElement | null} */
					const tmpl = document.querySelector(`#theme-icons`);
					const newIcon = tmpl && tmpl.content.querySelector('.' + theme);
					if (newIcon) {
						const oldIcon = picker.querySelector('svg.label-icon');
						if (oldIcon) {
							oldIcon.replaceChildren(...newIcon.cloneNode(true).childNodes);
						}
					}
				});
			},
		};
	})();
</script><template id="theme-icons"><svg aria-hidden="true" class="light astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M5 12a1 1 0 0 0-1-1H3a1 1 0 0 0 0 2h1a1 1 0 0 0 1-1Zm.64 5-.71.71a1 1 0 0 0 0 1.41 1 1 0 0 0 1.41 0l.71-.71A1 1 0 0 0 5.64 17ZM12 5a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1a1 1 0 0 0 1 1Zm5.66 2.34a1 1 0 0 0 .7-.29l.71-.71a1 1 0 1 0-1.41-1.41l-.66.71a1 1 0 0 0 0 1.41 1 1 0 0 0 .66.29Zm-12-.29a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.71-.71a1.004 1.004 0 1 0-1.43 1.41l.73.71ZM21 11h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm-2.64 6A1 1 0 0 0 17 18.36l.71.71a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.76-.66ZM12 6.5a5.5 5.5 0 1 0 5.5 5.5A5.51 5.51 0 0 0 12 6.5Zm0 9a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Zm0 3.5a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1a1 1 0 0 0-1-1Z"/></svg> <svg aria-hidden="true" class="dark astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.64 13a1 1 0 0 0-1.05-.14 8.049 8.049 0 0 1-3.37.73 8.15 8.15 0 0 1-8.14-8.1 8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69 1 1 0 0 0-.36-1.05Zm-9.5 6.69A8.14 8.14 0 0 1 7.08 5.22v.27a10.15 10.15 0 0 0 10.14 10.14 9.784 9.784 0 0 0 2.1-.22 8.11 8.11 0 0 1-7.18 4.32v-.04Z"/></svg> <svg aria-hidden="true" class="auto astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> </template><link rel="stylesheet" href="/it_docs/_astro/index.BsC2KTtW.css" /><script type="module" src="/it_docs/_astro/hoisted.BxjUbMOm.js"></script>
<script type="module" src="/it_docs/_astro/page.CZ0TFQCk.js"></script></head> <body class="astro-bguv2lll"> <a href="#_top" class="astro-7q3lir66">Skip to content</a>  <div class="page sl-flex astro-vrdttmbt"> <header class="header astro-vrdttmbt"><div class="header sl-flex astro-kmkmnagf"> <div class="title-wrapper sl-flex astro-kmkmnagf"> <a href="/it_docs/" class="site-title sl-flex astro-m46x6ez3">  <span class="astro-m46x6ez3"> IT Docs </span> </a>  </div> <div class="sl-flex astro-kmkmnagf"> <site-search data-translations="{&#34;placeholder&#34;:&#34;Search&#34;}" class="astro-v37mnknz"> <button data-open-modal disabled class="astro-v37mnknz">  <svg aria-label="Search" class="astro-v37mnknz astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.71 20.29 18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 0-14 7 7 0 0 1 0 14Z"/></svg>  <span class="sl-hidden md:sl-block astro-v37mnknz" aria-hidden="true">Search</span> <svg aria-label="(Press / to Search)" class="sl-hidden md:sl-block astro-v37mnknz astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 2H7a5 5 0 0 0-5 5v10a5 5 0 0 0 5 5h10a5 5 0 0 0 5-5V7a5 5 0 0 0-5-5Zm3 15a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h10a3 3 0 0 1 3 3v10Z"/><path d="M15.293 6.707a1 1 0 1 1 1.414 1.414l-8.485 8.486a1 1 0 0 1-1.414-1.415l8.485-8.485Z"/></svg>  </button> <dialog style="padding:0" aria-label="Search" class="astro-v37mnknz"> <div class="dialog-frame sl-flex astro-v37mnknz">  <button data-close-modal class="sl-flex md:sl-hidden astro-v37mnknz"> Cancel </button> <div class="search-container astro-v37mnknz"> <div id="starlight__search" class="astro-v37mnknz"></div> </div> </div> </dialog> </site-search>    </div> <div class="sl-hidden md:sl-flex right-group astro-kmkmnagf"> <div class="sl-flex social-icons astro-kmkmnagf"> <a href="https://github.com/GGsmou" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">GitHub</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" class="astro-4yphtoen"> <option value="dark" class="astro-4yphtoen">Dark</option><option value="light" class="astro-4yphtoen">Light</option><option value="auto" selected="true" class="astro-4yphtoen">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div> </div> </header> <nav class="sidebar astro-vrdttmbt" aria-label="Main"> <starlight-menu-button class="astro-jif73yzw"> <button aria-expanded="false" aria-label="Menu" aria-controls="starlight__sidebar" class="sl-flex md:sl-hidden astro-jif73yzw"> <svg aria-hidden="true" class="astro-jif73yzw astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"/></svg>  </button> </starlight-menu-button>    <div id="starlight__sidebar" class="sidebar-pane astro-vrdttmbt"> <div class="sidebar-content sl-flex astro-vrdttmbt"> <ul class="top-level astro-3ii7xxms"> <li class="astro-3ii7xxms"> <details open class="astro-3ii7xxms"> <summary class="astro-3ii7xxms"> <div class="group-label astro-3ii7xxms"> <span class="large astro-3ii7xxms">Overview</span>  </div> <svg aria-hidden="true" class="caret astro-3ii7xxms astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-3ii7xxms"> <li class="astro-3ii7xxms"> <a href="/it_docs/all/algorithms__data_structures/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Algorithms and Data Structures</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/architecture/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Architecture</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/backend/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">BackEnd</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/cli/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">CLI</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/code_complete_2-steve_mcconnel/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Notes of &quot;Code Complete 2nd edition&quot; by Steve McConnel</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/code_snippets/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Code_Snippets</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/css/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">CSS</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/design/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Design</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/designing_data_intensive_applications-oreilly/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Notes of &quot;Designing Data-Intensive Applications&quot; by O&#39;Reilly</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/domain_driven_design-evans/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Notes of &quot;Domain Driven Design&quot; by Evans</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/fintech/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Fintech</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/frontend/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">FrontEnd</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/general/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">General</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/go/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">GO</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/it/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">IT</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/js/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">JS</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/management/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Management</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/nodejs/" aria-current="page" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">NodeJS</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/optimization/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Optimization</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/react/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">React</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/security/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Security</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/software_architecture_the_hard_parts-oreilly/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Notes of &quot;Software Architecture The Hard Parts&quot; by O&#39;Reilly</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/software_engineering_at_google-oreilly/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Notes of &quot;Software Engineering at Google&quot; by O&#39;Reilly</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/system_design/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">System_Design</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/testing/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">Testing</span>  </a> </li><li class="astro-3ii7xxms"> <a href="/it_docs/all/ts/" class="astro-3ii7xxms"> <span class="astro-3ii7xxms">TS</span>  </a> </li> </ul>  </details> </li> </ul>  <div class="md:sl-hidden"> <div class="mobile-preferences sl-flex astro-wu23bvmt"> <div class="sl-flex social-icons astro-wu23bvmt"> <a href="https://github.com/GGsmou" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">GitHub</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" class="astro-4yphtoen"> <option value="dark" class="astro-4yphtoen">Dark</option><option value="light" class="astro-4yphtoen">Light</option><option value="auto" selected="true" class="astro-4yphtoen">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div>  </div> </div> </div> </nav> <div class="main-frame astro-vrdttmbt">  <div class="lg:sl-flex astro-67yu43on"> <aside class="right-sidebar-container astro-67yu43on"> <div class="right-sidebar astro-67yu43on"> <div class="lg:sl-hidden astro-pb3aqygn"><mobile-starlight-toc data-min-h="2" data-max-h="6" class="astro-doynk5tl"><nav aria-labelledby="starlight__on-this-page--mobile" class="astro-doynk5tl"><details id="starlight__mobile-toc" class="astro-doynk5tl"><summary id="starlight__on-this-page--mobile" class="sl-flex astro-doynk5tl"><div class="toggle sl-flex astro-doynk5tl">On this page<svg aria-hidden="true" class="caret astro-doynk5tl astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </div><span class="display-current astro-doynk5tl"></span></summary><div class="dropdown astro-doynk5tl"><ul class="isMobile astro-g2bywc46" style="--depth: 0;"> <li class="astro-g2bywc46" style="--depth: 0;"> <a href="#_top" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#enterprise-node-by-khalilstemmler" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Enterprise Node by Khalilstemmler</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#dtos-as-layer-of-indirection" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">DTOs as Layer of Indirection</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#event-based-systems" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Event Based Systems</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#functional-error-handling" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Functional Error Handling</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#use-case-layer" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Use-case layer</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#clean-architecture" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Clean Architecture</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#clean-contollers" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Clean Contollers</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#understanding-core-concepts" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Understanding Core Concepts</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#intro" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Intro</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 2;"> <li class="astro-g2bywc46" style="--depth: 2;"> <a href="#cli" class="astro-g2bywc46" style="--depth: 2;"> <span class="astro-g2bywc46" style="--depth: 2;">CLI</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 2;"> <a href="#node-versioning" class="astro-g2bywc46" style="--depth: 2;"> <span class="astro-g2bywc46" style="--depth: 2;">Node versioning</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 2;"> <a href="#nodejs-under-the-hood" class="astro-g2bywc46" style="--depth: 2;"> <span class="astro-g2bywc46" style="--depth: 2;">NodeJS Under the Hood</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 2;"> <a href="#eventemitter" class="astro-g2bywc46" style="--depth: 2;"> <span class="astro-g2bywc46" style="--depth: 2;">EventEmitter</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#buffers" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Buffers</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#file-system" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">File System</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#streams" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Streams</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#networking-lowest-level-possible-in-node" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Networking (lowest level possible in Node)</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#http" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">HTTP</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#unix" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Unix</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#compression" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Compression</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#multi-threading" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Multi-Threading</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#cryptography" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Cryptography</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#security" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Security</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#asynclocalstorage" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">AsyncLocalStorage</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#modern-nodejs-can-do-that" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Modern Node.js Can Do That</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#reference-architecture-by-red-hat" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Reference Architecture by Red Hat</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#logging" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Logging</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#code-consistency" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Code Consistency</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#graphql" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">GraphQL</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#containers" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Containers</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#frameworks" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Frameworks</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#code-coverage" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Code Coverage</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#ts" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">TS</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#security-1" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Security</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#accessibility" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Accessibility</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#dev-workflows" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Dev workflows</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#npm-development" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">npm development</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#problem-determination" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Problem determination</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#testing" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Testing</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#transactions" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Transactions</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#load-balancing-threading-and-scaling" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Load balancing, threading, and scaling</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#cicd" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">CI/CD</span> </a>  </li> </ul>  </li> </ul> </div></details></nav></mobile-starlight-toc></div><div class="right-sidebar-panel sl-hidden lg:sl-block astro-pb3aqygn"><div class="sl-container astro-pb3aqygn"><starlight-toc data-min-h="2" data-max-h="6"><nav aria-labelledby="starlight__on-this-page"><h2 id="starlight__on-this-page">On this page</h2><ul class="astro-g2bywc46" style="--depth: 0;"> <li class="astro-g2bywc46" style="--depth: 0;"> <a href="#_top" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#enterprise-node-by-khalilstemmler" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Enterprise Node by Khalilstemmler</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#dtos-as-layer-of-indirection" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">DTOs as Layer of Indirection</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#event-based-systems" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Event Based Systems</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#functional-error-handling" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Functional Error Handling</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#use-case-layer" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Use-case layer</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#clean-architecture" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Clean Architecture</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#clean-contollers" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Clean Contollers</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#understanding-core-concepts" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Understanding Core Concepts</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#intro" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Intro</span> </a> <ul class="astro-g2bywc46" style="--depth: 2;"> <li class="astro-g2bywc46" style="--depth: 2;"> <a href="#cli" class="astro-g2bywc46" style="--depth: 2;"> <span class="astro-g2bywc46" style="--depth: 2;">CLI</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 2;"> <a href="#node-versioning" class="astro-g2bywc46" style="--depth: 2;"> <span class="astro-g2bywc46" style="--depth: 2;">Node versioning</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 2;"> <a href="#nodejs-under-the-hood" class="astro-g2bywc46" style="--depth: 2;"> <span class="astro-g2bywc46" style="--depth: 2;">NodeJS Under the Hood</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 2;"> <a href="#eventemitter" class="astro-g2bywc46" style="--depth: 2;"> <span class="astro-g2bywc46" style="--depth: 2;">EventEmitter</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#buffers" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Buffers</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#file-system" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">File System</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#streams" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Streams</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#networking-lowest-level-possible-in-node" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Networking (lowest level possible in Node)</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#http" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">HTTP</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#unix" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Unix</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#compression" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Compression</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#multi-threading" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Multi-Threading</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#cryptography" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Cryptography</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#security" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Security</span> </a>  </li> </ul>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#asynclocalstorage" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">AsyncLocalStorage</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#modern-nodejs-can-do-that" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Modern Node.js Can Do That</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 0;"> <a href="#reference-architecture-by-red-hat" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Reference Architecture by Red Hat</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#logging" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Logging</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#code-consistency" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Code Consistency</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#graphql" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">GraphQL</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#containers" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Containers</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#frameworks" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Frameworks</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#code-coverage" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Code Coverage</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#ts" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">TS</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#security-1" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Security</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#accessibility" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Accessibility</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#dev-workflows" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Dev workflows</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#npm-development" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">npm development</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#problem-determination" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Problem determination</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#testing" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Testing</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#transactions" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Transactions</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#load-balancing-threading-and-scaling" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Load balancing, threading, and scaling</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#cicd" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">CI/CD</span> </a>  </li> </ul>  </li> </ul> </nav></starlight-toc></div></div> </div> </aside> <div class="main-pane astro-67yu43on">  <main data-pagefind-body lang="en" dir="ltr" class="astro-bguv2lll">    <div class="content-panel astro-7nkwcw3z"> <div class="sl-container astro-7nkwcw3z"> <h1 id="_top" class="astro-j6tvhyss">NodeJS</h1>  </div> </div>  <div class="content-panel astro-7nkwcw3z"> <div class="sl-container astro-7nkwcw3z"> <div class="sl-markdown-content"> <h2 id="enterprise-node-by-khalilstemmler">Enterprise Node by Khalilstemmler</h2>
<h4 id="dtos-as-layer-of-indirection">DTOs as Layer of Indirection</h4>
<p>Different parts of software must be connected in order to do somethings useful, BUT too tight connection will cause waterfall changes into downstream, when upstream introduce some change (thigh coupling)</p>
<p>Data Transfer Objects is one way to lower coupling, by introducing mapping of DB/ORM models into our own DTOs, thus</p>
<ul>
<li>introducing single point of change (by adding single mapper)</li>
<li>hiding implementation details of DB
<ul>
<li>dependency inversion</li>
</ul>
</li>
<li>allowing for changes more easily
<ul>
<li>the easier is to change design decision the better</li>
</ul>
</li>
<li>creating a contract for API</li>
</ul>
<p>You have domain objects (that your domain layer needs), data transfer objects (that your clients need), and the raw sequelize objects (that your database needs). The mapper handles transformations between all of ‘em.</p>
<h4 id="event-based-systems">Event Based Systems</h4>
<p>Event Based Systems go hand-in-hand with DDD and is a great way of thinking and dealing with complex problems, because it is:</p>
<ul>
<li>easy to express communication, ex: UserRegistered -> EmailVerificationSent -> EmailVerified</li>
<li>possible to record system state as history of events</li>
<li>possible to scale by making heavy operations async</li>
<li>reduce complexity via indirection</li>
</ul>
<h4 id="functional-error-handling">Functional Error Handling</h4>
<p>Happy path is not only one, so we need a way to deal with errors</p>
<ul>
<li>errors represent state and need to be handled properly in proper place</li>
<li>throwing errors is mass disruption to flow of code, that can be seen as kinda of a <code dir="auto">goto</code> AND also it is just harder to reason about your program</li>
</ul>
<p>Errors can and should be a part of domain model, strictly defined on interface, so it is easier to work with them</p>
<ul>
<li>this leads to function or golang or error as value approach, where you have concepts like: <code dir="auto">Result&#x3C;T></code> OR even better <code dir="auto">Either&#x3C;E, T></code>, so you can return T value OR E error
<ul>
<li>it is pretty hard to work with types, when errors are “thrown” all over the place</li>
<li>alternatives are:
<ul>
<li>return <code dir="auto">null</code> - lead to impossibility or error handling, because no errors</li>
<li>throw <code dir="auto">error</code> - harder to type + constant try/catch</li>
</ul>
</li>
<li>in model above each error must have strictly defined type, so it is identifiable in any part of the code it propagates to</li>
<li>when working with Result you can create combination functional, that will calculate overall Result from array of Results</li>
</ul>
</li>
<li>in our model errors can be generic: Unauthorized, Unknown; domain related: business(UserNameAlreadyTaken), general(UserUnknownError)</li>
</ul>
<p>note that is is more of a solution for your custom app, otherwise you should:</p>
<ul>
<li>for libs - throw OR return error in first callback, due to it been standard
<ul>
<li>btw, when working with external lib in your app you can and should create adaptors to match your style</li>
</ul>
</li>
<li>for broken state of an app - throw via invariant/assert to identify incorrect flow of code</li>
<li>for unknown errors - throw, catch somewhere on top, log, return 500(or similar action)</li>
</ul>
<p>note that such approach is harder to adopt, but worth on scale</p>
<h4 id="use-case-layer">Use-case layer</h4>
<p>We can keep application logic as layer of use-cases, thus keeping all logic encapsulated and organized</p>
<p>use-case must:</p>
<ul>
<li>have actor, who would use it</li>
<li>be command OR query</li>
<li>be related to subdomain(a logical separation of the entire problem domain)(don’t forget to distinguish between core and generic subdomains)
<ul>
<li>remember about Conway’s law: Organizations that design systems, are constrained to produce designs that are copies of the communication structures of these organizations.</li>
<li>it must be possible to extract subdomain as micro-services</li>
</ul>
</li>
</ul>
<p>generally we will have such layers:</p>
<ul>
<li>domain to keep domain types and logic</li>
<li>infra to keep networking, DB etc</li>
<li>use-case layer to bound domain with infra with additional app logic</li>
</ul>
<p>notes:</p>
<ul>
<li>your project structure must give basic proper understanding of your system</li>
<li>use-cases must be executable in any env, if all dependencies are provided, meaning that we could pass them to server controller OR to test</li>
<li>use-cases can use other use-cases</li>
</ul>
<h4 id="clean-architecture">Clean Architecture</h4>
<p>Our app must distinguish business logic(abstract, declarative) and infra logic(implementation focused, often imperative)</p>
<p>Business logic can’t depend on infra</p>
<p>Define interfaces as strict contracts AND then define implementations of those interface for specific cases(ex: tests, server controller)</p>
<ul>
<li>by passing implementations as dependencies you enable testability and flexibility of your code
<ul>
<li>it is easy to test domain, it is harder and slower to test infra, BUT infra is often external(ex: Redis), so no much need to do so</li>
</ul>
</li>
</ul>
<p>The only way we can be certain about changing code is to have written tests for it.</p>
<h4 id="clean-contollers">Clean Contollers</h4>
<p>We need to have some basic controller functional, that all other controllers will inherit, like:</p>
<ul>
<li>take req and send resp
<ul>
<li>it also includes proper parsing AND stringifying</li>
</ul>
</li>
<li>return 200/201 with/without data</li>
<li>return 400/similar with custom error</li>
<li>return 500/similar with default error
<ul>
<li>includes loggin, ideally via DI passed logger</li>
</ul>
</li>
</ul>
<h2 id="understanding-core-concepts">Understanding Core Concepts</h2>
<p>Section will be about Node.js AND related BE topics</p>
<h4 id="intro">Intro</h4>
<h6 id="cli">CLI</h6>
<p>Command prompt - some info, that terminal will show to you all the time
Command line - input field to execute commands
Terminal - app to access CLI
Instruction - instruction to execute</p>
<ul>
<li>instructions are written in some scripting language</li>
</ul>
<p>commands:</p>
<ul>
<li><code dir="auto">cd dir</code> - go to directory
<ul>
<li>cd == change dir</li>
</ul>
</li>
<li><code dir="auto">mkdir name name2 ...</code> - create folder
<ul>
<li>other commands also can chain inputs like so</li>
</ul>
</li>
<li><code dir="auto">pwd</code> - print current full path</li>
<li><code dir="auto">touch name.ext</code> - create file</li>
<li><code dir="auto">echo $var</code> - print string/parameter to console
<ul>
<li><code dir="auto">$var</code> is syntax to reference variable</li>
</ul>
</li>
<li><code dir="auto">ls filter</code> - list content of current dir
<ul>
<li><code dir="auto">filter</code> is glob patter (optional)</li>
<li><code dir="auto">-a</code> - show hidden files</li>
</ul>
</li>
<li><code dir="auto">mv path1 path2</code> - move OR rename file/folder</li>
<li><code dir="auto">ssh</code> - connect to external server</li>
<li><code dir="auto">vim</code>/<code dir="auto">nano</code> - terminal text editors</li>
<li><code dir="auto">cat file</code> - print content of a file</li>
<li><code dir="auto">rm path</code> - remove path</li>
<li><code dir="auto">man command</code> - command docs</li>
<li><code dir="auto">open path</code> - open path with Finder</li>
</ul>
<p>shortcuts:</p>
<ul>
<li>ctr+A - go to the beginning of a line</li>
<li>ctr+E - go to the end of a line</li>
<li>arrow-[up/down] - move between command history</li>
</ul>
<p>notes:</p>
<ul>
<li><code dir="auto">~</code> == home dir</li>
<li>bash is stored as <code dir="auto">.sh</code></li>
<li><code dir="auto">..</code> go up a dir</li>
<li><code dir="auto">|</code> - pipe output of command to other command</li>
<li><code dir="auto">></code> - extract output of command</li>
<li>commands can be ran from inside, piped into and from a node.js</li>
</ul>
<h6 id="node-versioning">Node versioning</h6>
<p>Always use LTS for production (LTS changes every 2 years)</p>
<p>To switch version you can use <code dir="auto">nvm</code>:</p>
<ul>
<li><code dir="auto">ls</code> - list of installed node versions</li>
<li><code dir="auto">(un)install version</code> (un)install new version of node</li>
<li><code dir="auto">use version</code> use version of node</li>
<li>---</li>
<li>npm -g will store packages scoped by version</li>
<li><code dir="auto">.nvmrc</code> can be used to create dir scoped configs of nvm WITH possibility to always use specific node version(by specifying it at first line)
<ul>
<li>note: you still need to manually write <code dir="auto">nvm use</code></li>
</ul>
</li>
</ul>
<h6 id="nodejs-under-the-hood">NodeJS Under the Hood</h6>
<p>Programing is basically talking to CPU, which requires Machine Code(low level set of instruction, uniq per processor architecture), which can be generated from Assembly Language, which can be generated from high-low-level programing language like C/C++, that expose low-level details to coder, which can be abstracted via high-level language, that abstract implementation details</p>
<ul>
<li>JS is example of such high-level language, while NodeJS is something, that makes it possible to run JS on device</li>
<li>JS is first of all run by engine, like V8(embedded in NodeJS), SpiderMonkey etc AND only then embedded into other apps like NodeJS, Chrome etc, that expose additional functionality and syntax to it(ex: <code dir="auto">window</code>, <code dir="auto">global</code> etc), that is bound to JS
<ul>
<li>proper engine must implement ECMAScript specification, that states how JS must be ran</li>
</ul>
</li>
</ul>
<p>First major Node’s dependency is V8 to run JS, while second is libuv, library that exposes functionality to interact with OS, in order for Node to be properly used as server-side language</p>
<p>Other important Node concept is Event Loop, that handles code execution and proper interaction between libuv and V8, in such way, that it enables us to write non-blocking async code</p>
<ul>
<li>non-blocking operations are achieved via event-driven nature of Node, where you say to do start doing somethings AND when this something is done execute smth else OR send event about the result of operation</li>
<li>related commands:
<ul>
<li><code dir="auto">process.nextTick(cb)</code> - execute callback after main process is done</li>
</ul>
</li>
<li>watch out for operations that block main thread, such action will block both V8 and Event Loop
<ul>
<li>basically this happens due to Node been single threaded by it’s nature
<ul>
<li>this still implies possibility of spinning up several instances of Node and communicate between them in multi-threaded manner</li>
<li>libuv have N(default = 4) ports to do sys-operations
<ul>
<li>Node aims to use as low number of threads as possible</li>
</ul>
</li>
</ul>
</li>
<li>in general avoid: heavy operations done in one byte(regex, file processing), heavy sync functions, complex operations</li>
</ul>
</li>
</ul>
<h6 id="eventemitter">EventEmitter</h6>
<p>Object, that Node exposes to utilize event-driven communication via Observer pattern</p>
<ul>
<li>EventEmitter is implemented in pure JS and can be reimplemented without Node</li>
<li>events are used as a way to reduce overload, that otherwise will occur if we will do pseudo-events via something like polling(sync event management)</li>
</ul>
<p>ex:</p>
<div class="expressive-code"><link rel="stylesheet" href="/it_docs/_astro/ec.usa2f.css"><script type="module" src="/it_docs/_astro/ec.sgewm.js"></script><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">EventEmmiter</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#82AAFF;--1:#3C63B3">require</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">events</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">e</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#7FDBCA;--1:#097174">new</span><span style="--0:#C792EA;--1:#8D46B4"> </span><span style="--0:#82AAFF;--1:#3C63B3">EventEmmiter</span><span style="--0:#D6DEEB;--1:#403F53">();</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#7FDBCA;--1:#097174">e</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">on</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">eventName</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">undefined</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line"><span style="--0:#7FDBCA;--1:#097174">e</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">once</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">eventName</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">()</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">=></span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">undefined</span><span style="--0:#D6DEEB;--1:#403F53">); </span><span style="--0:#809191;--1:#5E6578">// run only once</span></div><div class="ec-line"><span style="--0:#7FDBCA;--1:#097174">e</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">off</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">eventName</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--1:#403F53"><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">someCB</span><span style="--0:#D6DEEB">) </span></span><span style="--0:#809191;--1:#5E6578">// unsubscribe from event</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#7FDBCA;--1:#097174">e</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">emit</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">eventName</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="const EventEmmiter = require(&#x22;events&#x22;);const e = new EventEmmiter();e.on(&#x22;eventName&#x22;, () => undefined);e.once(&#x22;eventName&#x22;, () => undefined); // run only oncee.off(&#x22;eventName&#x22;, someCB) // unsubscribe from evente.emit(&#x22;eventName&#x22;);"><div></div></button></div></figure></div>
<p>notes:</p>
<ul>
<li>CBs are called in order of assignment</li>
<li>event will trigger all CBs to be executed, even if several events are triggered one after another</li>
<li>Node provides identical to browser API methods for completeness sake</li>
</ul>
<h4 id="buffers">Buffers</h4>
<p>Binary data - data that consists of zeros and ones(aka base2 numbers), it is only data format that understood by computers</p>
<ul>
<li>1 bit is single 0 or 1</li>
<li>1 byte is 8 bits</li>
<li>convertion:
<ul>
<li>01011 (base2) -> <code dir="auto">1 * 2^0 + 1 * 2^1 + 0 * 2^2 + 1 * 2^3 + 0 * 2^4</code> -> 11 (base10)</li>
</ul>
</li>
<li>first digit of sequence is Least Significant Bit/Digit (LSB/LSD)</li>
<li>last digit of sequence is Most Significant Bit/Digit (MSB/MSD)</li>
</ul>
<p>Hexadecimal numbers - base16 numbers, that also widely used in computing, due to ease of conversion between base2 and base16, which enables easier notation etc</p>
<ul>
<li>4 bits can be represented as single hex character, thus convertion can be easily done via table</li>
<li>hex is notated as 0x… OR #…</li>
<li>convertion:
<ul>
<li>0x456 -> <code dir="auto">6 * 16^0 + 5 * 16^1 + 4 * 16^2</code> -> 1110</li>
</ul>
</li>
<li>number are represented as 0-F(case insensitive)
<ul>
<li>0-F == 0-15</li>
</ul>
</li>
</ul>
<p>To work with characters computer requires usage of character encoding, which is basically a table that maps characters to some base2 numbers in specific way</p>
<ul>
<li>ex:
<ul>
<li>ACSII // defines 128 characters of English language and related special characters, 8 bits per char, subset of unicode</li>
<li>Unicode(standard, that defines encodings: UTF-8, UTF-16, etc) // defines all possible characters
<ul>
<li>UTF-8 stores all characters in 8n bit sequences(8, 16, 24, 32)</li>
</ul>
</li>
</ul>
</li>
<li>note that “9” isn’t actual 9, it will be encoded as some other number</li>
<li>characters are transformed in process of encoding(transforming readable data to some format) and backward one called decoding</li>
<li>encoding must always be specified</li>
</ul>
<p>Buffer - container(allocated location) in memory, basically a data-structure to work with memory, that used to fastly write, hold, operate and read data in it</p>
<ul>
<li>buffer is always prefilled with zeros</li>
<li>Node buffers can be allocated and operated in byte size only
<ul>
<li>basically you can imagine it as an array with 1 byte per element</li>
</ul>
</li>
<li>buffer can’t be re-allocated, it is fixed size
<ul>
<li>overflown data will be auto-discarded by Node</li>
<li>avoid allocating redundant memory</li>
</ul>
</li>
<li>buffer is limited by number of available RAM</li>
<li>buffer can hold only positive values(0-255) per byte, BUT we can represent negative values via standards(ex: <code dir="auto">(2's compliment + 1) * -1</code>)</li>
<li>methods:
<ul>
<li><code dir="auto">Buffer.from(arr)</code> - allocate buffer of proper size and populate it with provided data
<ul>
<li>alternative is to provide: <code dir="auto">(string, method)</code> args to it</li>
</ul>
</li>
<li><code dir="auto">buffer.fill(value)</code> - fill value with provided value</li>
<li>---</li>
<li>most of methods can be re-implemented, BUT it will be less efficient due to internal optimizations</li>
</ul>
</li>
<li>notes:
<ul>
<li>default max buffer size is 4GB, BUT it can be changed</li>
</ul>
</li>
</ul>
<p>Notes:</p>
<ul>
<li>URLs will encode non-ASCII chars as hexadecimals in UTF-8</li>
<li>Node pre-allocates memory region to place there your buffers</li>
<li>Buffer is subclass of <code dir="auto">Uint8Array</code></li>
<li>Buffers support operations like <code dir="auto">.indexOf</code> and similar iterative things, like in arrays</li>
</ul>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">const { </span><span style="--0:#82AAFF;--1:#3C63B3">Buffer</span><span style="--0:#C792EA;--1:#8D46B4"> } = </span><span style="--0:#82AAFF;--1:#3C63B3">require</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">buffer</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">size</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#F78C6C;--1:#AA0982">16</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">filler</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#F78C6C;--1:#AA0982">420</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#616671">/*</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">allocation will always fill memory with `filler` OR `0`, so it can be slower</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">*/</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">buf1</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#7FDBCA;--1:#097174">Buffer</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">alloc</span><span style="--1:#403F53"><span style="--0:#D6DEEB">(</span><span style="--0:#D7DBE0">size</span></span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--1:#403F53"><span style="--0:#D7DBE0">filler</span><span style="--0:#D6DEEB">);</span></span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#616671">/*</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">allocate free region of memory, BUT don't clean it</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">risks: sensitive data can become part of a buffer, memory content might be compromised</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">if you need additional speed with safety, always fill this buffer ASAP</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">*/</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">buf2</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#7FDBCA;--1:#097174">Buffer</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">allocUnsafe</span><span style="--1:#403F53"><span style="--0:#D6DEEB">(</span><span style="--0:#D7DBE0">size</span><span style="--0:#D6DEEB">);</span></span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">buf3</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#7FDBCA;--1:#097174">Buffer</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">from</span><span style="--0:#D6DEEB;--1:#403F53">([ </span><span style="--0:#809191;--1:#616671">/* ... */</span><span style="--0:#D6DEEB;--1:#403F53"> ]);</span></div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">const </span><span style="--0:#82AAFF;--1:#3C63B3">buf4</span><span style="--0:#C792EA;--1:#8D46B4"> = </span><span style="--0:#7FDBCA;--1:#097174">Buffer</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">concat</span><span style="--1:#403F53"><span style="--0:#D6DEEB">(</span><span style="--0:#D7DBE0">buf1</span></span><span style="--0:#C792EA;--1:#8D46B4">, </span><span style="--1:#403F53"><span style="--0:#D7DBE0">buf2</span><span style="--0:#D6DEEB">);</span></span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#616671">/*</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">the fastest way is to perform allocUnsafe on memory size that is &#x3C;= Buffer.poolSize >>> 1 (>>> == bit shift to the right, with dropping LSD)</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">>>> is equal to division by 2 + Math.flour</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">*/</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#809191;--1:#616671">/*</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">Similar to unsafe, but doesn't utilize memory right away, so called slow</span></div><div class="ec-line"><span style="--0:#809191;--1:#616671">*/</span></div><div class="ec-line"><span style="--0:#7FDBCA;--1:#097174">Buffer</span><span style="--0:#C792EA;--1:#8D46B4">.</span><span style="--0:#82AAFF;--1:#3C63B3">allocUnsafeSlow</span><span style="--1:#403F53"><span style="--0:#D6DEEB">(</span><span style="--0:#D7DBE0">size</span><span style="--0:#D6DEEB">);</span></span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="const { Buffer } = require(&#x27;buffer&#x27;);const size = 16;const filler = 420;/*allocation will always fill memory with &#x60;filler&#x60; OR &#x60;0&#x60;, so it can be slower*/const buf1 = Buffer.alloc(size, filler);/*allocate free region of memory, BUT don&#x27;t clean itrisks: sensitive data can become part of a buffer, memory content might be compromisedif you need additional speed with safety, always fill this buffer ASAP*/const buf2 = Buffer.allocUnsafe(size);const buf3 = Buffer.from([ /* ... */ ]);const buf4 = Buffer.concat(buf1, buf2);/*the fastest way is to perform allocUnsafe on memory size that is <= Buffer.poolSize >>> 1 (>>> == bit shift to the right, with dropping LSD)>>> is equal to division by 2 + Math.flour*//*Similar to unsafe, but doesn&#x27;t utilize memory right away, so called slow*/Buffer.allocUnsafeSlow(size);"><div></div></button></div></figure></div>
<h4 id="file-system">File System</h4>
<p>When working with files in node you are actually working with Buffers, that represent content of file in binary format</p>
<p>File is basically a sequence of bits, that can be decoded in some specific manner(text, image etc)</p>
<ul>
<li>file has content AND metadata about this file</li>
<li>Node is talking with OS via libuv that wraps SysCalls, that perform operations with files
<ul>
<li>any file operation will use thread pool</li>
</ul>
</li>
</ul>
<p>Node has 3 implementations for same <code dir="auto">fs</code> API: sync, async via callbacks, async via Promises</p>
<ul>
<li>they has no difference underneath the hood, but simply just a syntactic sugar</li>
<li>Promises are the easiest to use</li>
<li>callbacks are the fastest
<ul>
<li>note: errors always passed as first values in cb</li>
</ul>
</li>
<li>synchronous can be used only for blocking operations</li>
</ul>
<p>notes:</p>
<ul>
<li><code dir="auto">fs.watch</code> can fire events several times per one save due to OS, program and other issues, out of our control</li>
<li>to properly execute read/write operations on file you need to open it first(assigns constant id number, that will identify this file and allow to refer to it for doing operation) AND then execute needed operation, using returned handler
<ul>
<li>files must be closed to avoid memory leaks</li>
<li>this operation allows fine grained access to file(open for long time, manage metadata, read in chunks, manage reading/writing streams etc), BUT it can be omitted, when you just need to quickly read somethings</li>
<li>reading will shift position, so you might need to override default params</li>
</ul>
</li>
<li>Node can decode/encode only characters, not images, videos etc</li>
</ul>
<h4 id="streams">Streams</h4>
<p>Basically stream is flow of some data, that either written OR read</p>
<ul>
<li>data is added/received in chunks
<ul>
<li>in Node, size chunk is 16kb</li>
</ul>
</li>
<li>with stream you may sacrifice speed, by doing additional operations, BUT get reduction in resource usage
<ul>
<li>BUT, if your data writes are smaller then 16kb, you will reduce number of operations</li>
</ul>
</li>
<li>types:
<ul>
<li>writable - used to write to
<ul>
<li>has internal Buffer to fill one chunk size, which will be emptied with corresponding operation(ex: write chunk to file)</li>
<li>Node will auto hold superfluous data in memory, if there is not place left in Buffer, until Buffer is emptied
<ul>
<li>stream has <code dir="auto">drain</code> event that signifies, that Buffer emptied and can be filled again, SO you can prevent memory additional memory consumption</li>
</ul>
</li>
<li>omit closing stream before it finishes it’s execution to omit data loss</li>
</ul>
</li>
<li>readable - used to read from
<ul>
<li>exposes <code dir="auto">data</code> event, that will be fired after Buffer is filled and ready to be drained</li>
<li>readable stream is created in paused state, when event handler is added we start to read AND, after there is nothing else to read stream is closed
<ul>
<li>closed state can be detected by <code dir="auto">"end"</code> event</li>
</ul>
</li>
</ul>
</li>
<li>duplex - writable + readable
<ul>
<li>has two separate Buffers to do reading and writing</li>
</ul>
</li>
<li>transform - duplex, that can change data on fly</li>
</ul>
</li>
</ul>
<p>API (for consumers)</p>
<ul>
<li>writable stream
<ul>
<li>to check size of writable stream you can use <code dir="auto">.writableHighWaterMark</code> AND to check how much of internal buffer is filled at the moment <code dir="auto">.writableLength</code> exists
<ul>
<li>alternatively you can check <code dir="auto">boolean</code> returned by <code dir="auto">.write</code>, that will tell wether you can write to buffer OR write will go to memory
<ul>
<li>generally avoid writing if <code dir="auto">.write</code> returns <code dir="auto">false</code>, if you got <code dir="auto">false</code> WAIT for <code dir="auto">"drain"</code> event</li>
</ul>
</li>
<li><code dir="auto">"drain"</code> happens only if full buffer fully emptied</li>
</ul>
</li>
<li>to do last write and close stream you can use <code dir="auto">.end(data)</code>
<ul>
<li>next writes will always <code dir="auto">throw</code></li>
<li><code dir="auto">.end</code> will emit <code dir="auto">"finish"</code> event</li>
</ul>
</li>
<li>if underlying resource(ex: file) is closed(<code dir="auto">.close()</code>), stream will be closed and emit <code dir="auto">"close"</code> event</li>
<li>stream can be prevented from flushing data by <code dir="auto">.cork()</code> and later re-enabled by <code dir="auto">.uncork()</code></li>
<li><code dir="auto">.destroy()</code> will remove stream and underlying buffer</li>
<li>you can change default encoding of stream via <code dir="auto">.setDefaultEncoding()</code></li>
</ul>
</li>
<li>readable stream
<ul>
<li>stream can be in two modes <code dir="auto">stoped</code> and resumed(<code dir="auto">flowing</code>)
<ul>
<li>all streams are paused from the moment of creation, until <code dir="auto">"data"</code> event is added OR some other stream is piped via <code dir="auto">.pipe()</code> OR <code dir="auto">.resume()</code> is called</li>
<li>stream will be stopped, if <code dir="auto">.pause()</code> is called OR all piped streams are removed via <code dir="auto">.unpipe()</code></li>
<li>can be tracked via <code dir="auto">.readableFlowing</code></li>
</ul>
</li>
<li>events:
<ul>
<li><code dir="auto">"data" / "readable"</code> - receive data chunks
<ul>
<li>don’t mix <code dir="auto">"readable"</code> and <code dir="auto">"data"</code> event usage</li>
</ul>
</li>
<li><code dir="auto">"end"</code> - reading is finished</li>
<li><code dir="auto">"close"</code> - stream is closed</li>
<li><code dir="auto">"pause</code> - stream is paused</li>
<li><code dir="auto">"error</code> - error happened</li>
</ul>
</li>
<li><code dir="auto">.pipe()</code> allows to pass data from readable to writable stream, with auto-handling of backpressure
<ul>
<li>accepts only writable stream OR duplex OR transform, both of which implement writable stream</li>
<li>pipe returns stream, that was passed into it, so you can chain duplex streams, BUT not writable streams</li>
<li>avoid using pipe, when already subscribed to <code dir="auto">"data"</code> event of readable stream</li>
<li><code dir="auto">.unpipe()</code> can be used to pause/stop reading</li>
<li>there are several events: <code dir="auto">"pipe"</code>, <code dir="auto">"unpipe"</code></li>
<li>note, that <code dir="auto">pipe</code> has bad error handling, so, for production, it is better to use <code dir="auto">pipeline(source, ...duplex/transform[], destination, (err, val) => {}</code>, that will kill underlying streams on error and pass this error to cb OR return final value
<ul>
<li>by default <code dir="auto">.pipe</code> won’t do clean-up, so you need to manually call <code dir="auto">.destroy()</code> on each stream</li>
</ul>
</li>
</ul>
</li>
<li><code dir="auto">.finished</code> - called when stream errored OR not writable/readable OR unexpectedly closed, so you can do clean-up</li>
<li>notes:
<ul>
<li>default buffer size for <code dir="auto">fs</code> readable buffers is 64kb</li>
<li>when doing somethings like read from file and write to other file watch for backpressure, aka problem when you have higher input speed then output, THAT will ultimately cause memory issues
<ul>
<li>in <code dir="auto">fs</code> this will happen due to hard-drive reading speed been much faster then write speed</li>
</ul>
</li>
<li><code dir="auto">cat</code> unix command is analog of readable stream, because it will partially read file by chunks</li>
<li>your aren’t guaranteed that data will be split in proper chunks, ex: <code dir="auto">"123 123  123"</code> string can be read as <code dir="auto">"12" + " 1" ...</code></li>
<li><code dir="auto">fs.copy</code> will copy via streams</li>
<li>by default, files over 2GB can’t be read directly without streams</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>API (for custom streams)</p>
<ul>
<li>
<p>generally custom streams are created by inheriting from base stream class(<code dir="auto">Writable</code>, <code dir="auto">Readable</code>, <code dir="auto">Duplex</code>, <code dir="auto">Transform</code>), with need to implement some predefined set of methods</p>
<ul>
<li>omit emitting events by hand OR overwriting existing methods, use predefined callbacks AND overwrite only internal, allowed methods</li>
<li>omit throwing errors inside custom functions, pass errors to callbacks</li>
<li>JS don’t have multiple inheritance(thanks God), so Duplex is basically a built in class to do multiple inheritance from <code dir="auto">Writable</code> and <code dir="auto">Readable</code></li>
</ul>
</li>
<li>
<p>Duplex - stream that both writable and readable, BUT writing and reading is done fully separately(separate Buffers, separate source of reading and writing etc)</p>
<ul>
<li>it is possible to make Duplex’s read and write parts interact, BUT they don’t have to
<ul>
<li>this will make duplex a transform string (subtype of duplex)</li>
<li>transform inherits from duplex, BUT read and write methods are set in described above manner</li>
<li>transform can be: put through(no data transformation occur) and proper transform(data is changed in some manner)</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Notes:</p>
<ul>
<li>streams can be used in object mode, where we moving not buffers, but JS objects
<ul>
<li><code dir="auto">highWatermark</code> will specify number of objects</li>
<li>streams can also be used on FE in browser, mainly to work with network streams
<ul>
<li>note that browsers are using streams under the hood(ex: video streaming), BUT this API allows to utilize it in your code</li>
<li>Node has implementation of this API for compatibility, BUT it won’t replace Node’s streams API</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="networking-lowest-level-possible-in-node">Networking (<em>lowest level possible in Node</em>)</h4>
<p>Node is designed and focused on scalable networking apps</p>
<p>Main concepts:</p>
<ul>
<li>on pre-networking era information was passed via floppy discs
<ul>
<li>write data to disk, physically move it to other PC and read from disk</li>
</ul>
</li>
<li>networking elements are:
<ul>
<li>ethernet cable to move data</li>
<li>switch to connect several PCs to it and form small network
<ul>
<li>switch is receiving and sending packets of information from/to PC
<ul>
<li>each packet contains addresses of source and destination</li>
<li>switch can lookup addresses via address table</li>
</ul>
</li>
</ul>
</li>
<li>networking card - part of PC, that enables connection between ethernet and PC
<ul>
<li>each card has MAC Address associated with it, which is uniq per device and basically a 48bits, represented by 6 hexadecimals, separated by <code dir="auto">:</code></li>
</ul>
</li>
<li>router - basically a higher order switch, that can communicate in between networks of switches via IP addresses (uniq address assigned to some device)
<ul>
<li>router assigns IP addresses to elements inside it’s local network in similar uniq manner, BUT this IP addresses aren’t uniq on global scale</li>
</ul>
</li>
</ul>
</li>
<li>networking is broken into separate, but connected layers, that act as abstractions, that built one upon another
<ul>
<li>Physical - level where info is moved in form of bits via cables</li>
<li>Data Link - level where info is moved in form of frames, with backed in MAC addresses
<ul>
<li>done by switches</li>
</ul>
</li>
<li>Network - level where info is moved in form of packets, with backed in IP addresses
<ul>
<li>done by routers, which calc shortest distance to other router</li>
</ul>
</li>
<li>Transport - level where safety and lossless of data is guaranteed
<ul>
<li>data is moved in segments</li>
<li>additional responsibility is connection establishment and proper disconnection(notify both sides that connection closed)</li>
<li>port numbers are added on this level to connect to application layer</li>
<li>TCP and UDP live here (there are others, but Node doesn’t have native support for them)
<ul>
<li>TCP - data is received in the way to sent
<ul>
<li>3 way handshake is key algorithm -> A send connection packet, B respond with connection acknowledgment packet, A send data packets</li>
<li>headers (it has no IP related headers, because they are added on previous layer) (non-fixed size)
<ul>
<li>source port (16bits)</li>
<li>destination port (16bits)</li>
<li>sequence numbers (32bits) - keep data in order</li>
<li>acknowledgment numbers (32bits)</li>
<li>…other…</li>
<li>data</li>
</ul>
</li>
<li>ex: ssh, http</li>
</ul>
</li>
<li>UDP - data is sent as fast as possible, with potential losses
<ul>
<li>headers (fixed size of 8 bytes)
<ul>
<li>source port (16bits)</li>
<li>destination port (16bits)</li>
<li>segment length (16bits)</li>
<li>checksum length (16bits) - to prevent data corruption</li>
<li>data</li>
</ul>
</li>
<li>ex: http 3</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Application - abstract layer, where data is just data, that can be operated upon
<ul>
<li>Node server</li>
</ul>
</li>
</ul>
</li>
<li>Ports - a way to expose application to outside world (out of your PC)
<ul>
<li>it is device based, but standard recommends to:
<ul>
<li>0-1023 -> system ports, that ran as sudo</li>
<li>49152-65535 -> safe private ports
<ul>
<li>can be used for dynamic activity</li>
</ul>
</li>
<li>several apps can be created in same port, BUT they must have different transport(TCP/UDP/etc)</li>
</ul>
</li>
<li>there are list(iANA standard) of well known ports, that should be used for some standard activities
<ul>
<li>ssh = 22</li>
<li>http = 80 - specifying this port will redirect all http traffic without a port to your app</li>
<li>https = 443</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><code dir="auto">net</code> - module to work with network (on lowest level possible in Node) and inter-process communication (IPC), both of which have similar API</p>
<ul>
<li>it is base for something like <code dir="auto">http</code> module</li>
<li>creating server
<ul>
<li>every app must have port bound to it for proper routing</li>
<li>after server is created it exposes TCP connection to specified port
<ul>
<li>in Node it is represented as duplex stream</li>
</ul>
</li>
</ul>
</li>
<li>connection to server - <code dir="auto">net</code> allows to establish TCP connections with other servers via sockets, which is also a duplex stream
<ul>
<li>connection will <code dir="auto">throw</code>, if no server to connect was found, due to how TCP specification is made</li>
<li>connection will auto close, if server stops working</li>
<li>client also need to have port, so it will be opened on fly from “dynamic” range, specified by iana spec</li>
</ul>
</li>
</ul>
<p><code dir="auto">readline</code> - module to read line by line from readable stream</p>
<ul>
<li>can be greatly combined with <code dir="auto">process.stdIn</code>, which is readable stream, that accepts input from console
<ul>
<li>basically <code dir="auto">.question</code> will do all heavy lifting for you to achiev this</li>
</ul>
</li>
</ul>
<p>notes:</p>
<ul>
<li>all devices have built it loop-back address, which is universally standardized to be (<code dir="auto">127.0.0.1</code>, or <code dir="auto">localhost</code> DNS)
<ul>
<li>this address will reroute requests back to device(either by device itself OR by router)</li>
</ul>
</li>
<li>Node refers to opened connections as sockets, which, in SE world, means two opened connections, that have duplex style of communication</li>
<li>server can have multiple connections from clients, BUT each connection is represented through separate socket object</li>
<li>TCP packets are sent in order, BUT UDP aren’t</li>
<li>don’t forget to add encryption to your server(via TLS directly, or by using HTTPS, FTPS etc)</li>
<li>you can use <code dir="auto">pm2</code> CLI tool to run your Node process in background and keep shel interactive</li>
<li><code dir="auto">ssh</code> is tool to interact with server from CLI</li>
<li><code dir="auto">scp</code> is tool to handle file transfer with server</li>
</ul>
<p>IP - Internet Protocol (third layer in networking model)
IP Address - uniq address associated with device, that can be accessed through network</p>
<ul>
<li>v4 - 32bits, with 8 bits(0-255) per portion (4 portions), separated with <code dir="auto">.</code>
<ul>
<li>max number of uniq devices that can be in single network is 4 billion</li>
<li>IP comes with subnet mask, which indicates what portion of address is used for network and what for host (ex: 11111111.11111111.11111111.00000000, BUT in notation it will look like some <code dir="auto">some.ip.add.ress/24</code>, where 24 is number of <code dir="auto">1</code>, that can be in range of 0-32)
<ul>
<li>this network portion is used to distinguish what traffic is routed to which network AND then by network to what device to route it</li>
<li>great for distinguishing requests to local and non-local networks</li>
<li>network portions are stored as tables inside routers</li>
<li>this led to standardization of this masks in such way, that it is easy to route traffic across the globe
<ul>
<li>this results in IP address now containing your location in non-explicit manner</li>
<li>this list is somewhat dynamic</li>
</ul>
</li>
</ul>
</li>
<li>there are some private addresses, that used only for private networks and can’t be accessed from outside of network
<ul>
<li>reason for their existence is to save on public IP addresses (4 billon limit problem) and avoid assigning IP addresses to devices, that won’t need them in first place and can be just connected via private network)</li>
<li>to utilize them routers are doing NAT (Network Address Translation), that converts private IP address to public one
<ul>
<li>note that multiple privates can correspond to single public AND conflict resolution is done via NAT</li>
</ul>
</li>
<li>ex:
<ul>
<li>10.x.x.x</li>
<li>172.16.x.x</li>
<li>192.168.x.x</li>
<li>127.x.x.x - loopback
<ul>
<li>note that for IPv6 this reduced to just use 127.0.0.1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>some addresses are reserved for specific companies, like IANA</li>
</ul>
</li>
<li>v6 - while v4 is still widely used, we can’t allocate new IPv4s, so we need to have standard with higher number of uniq addresses
<ul>
<li>in general it is faster and more improved version of v4 with higher capacity</li>
<li>addresses
<ul>
<li>128 bits - 8 portions of 16 bits, separated by <code dir="auto">:</code> and represented as 8 portions of 4 hex values
<ul>
<li>2^128 devices</li>
</ul>
</li>
<li>leading zeros can be discarded
<ul>
<li>ex:
<ul>
<li><code dir="auto">00AF</code> -> <code dir="auto">AF</code></li>
<li><code dir="auto">0000</code> -> <code dir="auto">0</code></li>
<li><code dir="auto">0000:0000</code> -> <code dir="auto">::</code> // can be done only once per address</li>
</ul>
</li>
</ul>
</li>
<li>case insensitive (due to hex rules)</li>
</ul>
</li>
<li>private addresses:
<ul>
<li>loopback: <code dir="auto">0000:0000:0000:0000:0000:0000:0000:0001</code> OR <code dir="auto">::1</code> OR some other shorthand</li>
<li>AND thats it, because we don’t need to safe them anymore ;)</li>
</ul>
</li>
<li>adoption is hard due to legacy AND worsen UX, when working with such “ugly” numbers</li>
</ul>
</li>
</ul>
<p>DNS (Domain Name System) - system which basically doing conversion from human readable strings to IP addresses</p>
<ul>
<li>this all DNS resolution is handled by DNS servers, that contain tables for conversion
<ul>
<li>note that partial tables can be cached on any edge(browser, device, router, ICP, Country etc) of network</li>
<li>DNS servers are preconfigured on device, BUT this list can be reconfigured
<ul>
<li>reconfiguration can lead to DNS hijacking, where legit DNS is changed to route to non-legit IP
<ul>
<li>there is even dns module, built in in Node, that can do lookups and other related stuff
<ul>
<li>Node will auto-resolve DNSes for you, if domain name is passed instead of IP</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>built on top of TCP and can be built even via Node</li>
</ul>
</li>
<li>each PC has private DNS table, for things like <code dir="auto">localhost</code> + caching, mentioned before</li>
<li>great not only for UX, but to stabilize network, because single DNS can correspond to dynamic IP, or several IPs(great for keeping multiple servers on different edges of network and serve IP of closest one)</li>
</ul>
<p>UDP</p>
<ul>
<li>there is no guarantee of data ordering OR data completeness, when using UDP, BUT you gain speed
<ul>
<li>still, you can built something like HTTP 3, where you use UDP under the hood, BUT ensure data completeness via retries</li>
<li>this means that you work in connectionless model, meaning that you will just fire packets into the void and thats it
<ul>
<li>in Node you need to bind port, so your app can listen for any incoming info</li>
</ul>
</li>
</ul>
</li>
<li>Node allows to use UDP via <code dir="auto">dgram</code>, which uses similar socket interface as <code dir="auto">net</code>, BUT you don’t differentiate server from client here
<ul>
<li>Node has default limit for buffer size, that can be sent per single UDP request</li>
</ul>
</li>
<li>there are UDP4 for IPv4 and UDP6 for IPv6</li>
</ul>
<h4 id="http">HTTP</h4>
<p>HTTP (Hyper Text Transfer Protocol) - is a protocol(set of rules), that sits in Application layer of Networking and responsible for handling format of data been sent, it allows to sent different data(JSON, text, forms etc)</p>
<ul>
<li>HTTP is based on client/server model
<ul>
<li>each request:
<ul>
<li>establishes TCP/UDP connection</li>
<li>client sends message, that is called request (because only client can request somethings)
<ul>
<li>firstly headers are sent</li>
<li>then body is sent in chunks (last chunk states, that it is last chunk)</li>
</ul>
</li>
<li>server responds with message, that called response and it contains:
<ul>
<li>headers</li>
<li>body, that is sent in chunks, like message is sent</li>
</ul>
</li>
<li>kills (<code dir="auto">Connection: close</code>) TCP connection OR connection is kept (<code dir="auto">Connection: keep-alive</code>) for following requests
<ul>
<li>for web development, keeping connection is often main choice</li>
<li>you can also configure timeouts per connection AND limit max number of connections</li>
<li>network changes will cause re-establishing of connection</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>HTTP breaks your data into:
<ul>
<li>headers - some metadata from request, it includes:
<ul>
<li>method - indicator of what action should be taken</li>
<li>url - what endpoint is called</li>
<li>code - indicator about how server responded</li>
<li>other - how data is structured, other metadata about request etc</li>
</ul>
</li>
<li>body - actual data been sent
<ul>
<li>optional, but usually included</li>
<li><code dir="auto">req.body</code> comes as stream, that need to be properly handled
<ul>
<li>note that data can have predefined length, that defined by <code dir="auto">content-length</code>, OTHERSWISE <code dir="auto">transfer-encoding: chunked</code> must be used
<ul>
<li>improper content length will auto-cut your data, BUT you don’t need to explicitly <code dir="auto">.end()</code>  your stream</li>
</ul>
</li>
</ul>
</li>
<li>generally you will send JSON or plain text as body, but you can also send files in binary format OR multiple key-value(<code dir="auto">string</code> OR <code dir="auto">file</code>) pairs in <code dir="auto">form-data</code> format</li>
</ul>
</li>
</ul>
</li>
<li>codes(404 etc) are part of protocol
<ul>
<li>HTTP2 omits statusMessages in favor of codes</li>
</ul>
</li>
<li>it is first class citizen of Node, that accessible via <code dir="auto">http</code> module
<ul>
<li>request in response in plain <code dir="auto">http</code> module is readable and writable streams</li>
<li>clients in Node are called agents, they are corresponding to TCP connections
<ul>
<li>data is sent through agents via request objects, that act as duplex stream</li>
</ul>
</li>
</ul>
</li>
<li>there are 3 HTTP versions as for now (1.1, 2, 3), BUT Node natively supports 1.1 and 2
<ul>
<li>common strategy is to build 1.1 server and then enable 2 and 3 by adding proxies, that could convert from-to 1.1, to your server</li>
<li>there is also HTTPS, but it is just encrypted version of HTTP AND often also configured via proxies</li>
</ul>
</li>
<li>HTTP is stateless protocol, meaning that each request doesn’t know about existence of another one AND no state is preserved
<ul>
<li>BUT you still can introduce state via headers, like Cookies</li>
<li>one purpose is scalability (ability to proxy and distribute is possible only with stateless protocol)</li>
</ul>
</li>
<li>under the hood HTTP formats headline(method, url OR status code, status text), headers and body as string in specific format, that can be parsed to receive values
<ul>
<li>this makes HTTP requests easily readable, when encoded from bytes, BUT parsing them can be a bit problematic
<ul>
<li>also security is nightmare, so use HTTPS ;)</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>media types (MIME types) - a standard way to specify type of sent data</p>
<ul>
<li>in OS world file extension is analog of MIME type</li>
<li><code dir="auto">Content-Type</code> header is used to sent this info</li>
<li>it must be included for proper work of server/client
<ul>
<li>it is possible to figure-out content-type, but generally avoid this</li>
<li>it can be figured-out by:
<ul>
<li>magic numbers - some file encodings have a number at start to identify format</li>
<li>file extensions</li>
</ul>
</li>
</ul>
</li>
<li>structure: <code dir="auto">type/subtype;key=value</code>
<ul>
<li>type - main type part, ex: <code dir="auto">image</code>
<ul>
<li>there are two main classes: discrete(single file, ex: <code dir="auto">image</code>, <code dir="auto">text</code>) and multipart(multiple files, ex: <code dir="auto">multipart</code>, <code dir="auto">message</code>)</li>
</ul>
</li>
<li>subtype - some sub format of type, ex: <code dir="auto">png</code></li>
<li>key=value - option, addition info, ex: <code dir="auto">charset=utf-8</code></li>
</ul>
</li>
</ul>
<p>HTTP methods - data, that included in requests, that used to tell what action must be done by server</p>
<ul>
<li>HTTP methods mainly differ in been idempotent or not
<ul>
<li>in this case idempotent means that multiple calls of endpoint with this method can’t change server state multiple times(only first one), BUT responses can differ, if needed</li>
</ul>
</li>
<li>types:
<ul>
<li>GET - retrieve some resource
<ul>
<li>request don’t have body</li>
<li>response have body</li>
<li>idempotent</li>
</ul>
</li>
<li>POST - create some resource OR perform some action
<ul>
<li>request have body</li>
<li>response have body</li>
<li>not idempotent</li>
</ul>
</li>
<li>PUT - create(alternative to POST, when you need to have idempotent behavior) OR fully update resource
<ul>
<li>request have body</li>
<li>response have body</li>
<li>idempotent</li>
</ul>
</li>
<li>PATCH - partially update resource
<ul>
<li>request have body</li>
<li>response have body</li>
<li>idempotent</li>
</ul>
</li>
<li>DELETE - delete resource
<ul>
<li>request may have body</li>
<li>response may have body</li>
<li>idempotent</li>
</ul>
</li>
<li>HEAD - retrieve headers
<ul>
<li>request don’t have body</li>
<li>response don’t have body</li>
<li>idempotent</li>
</ul>
</li>
<li>OPTIONS - retrieve possible communication options(what headers can be used, CORS)
<ul>
<li>request don’t have body</li>
<li>response may have body</li>
<li>idempotent</li>
</ul>
</li>
<li>and other less important…</li>
</ul>
</li>
<li>notes:
<ul>
<li>use different types as much as possible, this will act as docs + make app easier to integrate with</li>
</ul>
</li>
</ul>
<p>HTTP status codes - numbers(codes), that used to communicate client what was result of executed operation (as response)</p>
<ul>
<li>ranges:
<ul>
<li>100-599 - general</li>
<li>100-199 - info</li>
<li>200-299 - success</li>
<li>300-399 - redirect</li>
<li>400-499 - client errors</li>
<li>500-599 - server errors</li>
</ul>
</li>
<li>notes:
<ul>
<li>generally try to be as descriptive as possible, BUT don’t give too much info to client for security reasons</li>
</ul>
</li>
</ul>
<p>notes:</p>
<ul>
<li>main difference between server and web server is that web server works with web, meaning it servers HTML, CSS, JS over HTTP and utilized Web APIs</li>
<li>as automatization matter you can auto-serve all files from your <code dir="auto">public</code> folder
<ul>
<li>don’t forget about proper mine types</li>
</ul>
</li>
<li>cookies - way to introduce state into stateless HTTP communication between server and browser
<ul>
<li>cookies can be set by server response header <code dir="auto">Set-Cookie: key=val</code>, where each header can hold only single cookie</li>
<li>client will always sent all it’s cookies to server in form of request <code dir="auto">Cookie: key=val; key2=val2</code> header
<ul>
<li>be careful with performance degradation</li>
<li>this can be mitigated by using <code dir="auto">Path</code> property, that will scope cookies sending to some path only</li>
</ul>
</li>
<li>ideally cookies shouldn’t be changed by client
<ul>
<li>this can be configured via <code dir="auto">httpOnly</code> property</li>
</ul>
</li>
<li>don’t forget to expire cookies via <code dir="auto">Expire</code> property</li>
<li>https can be enforced by <code dir="auto">Secure</code> property</li>
</ul>
</li>
<li>be careful when working with large bodies, omit loading them into memory at once, do piping instead
<ul>
<li>generally pipe when content-length is bigger then <code dir="auto">highWaterMark</code></li>
</ul>
</li>
</ul>
<h4 id="unix">Unix</h4>
<p>Unix - historically is machine agnostic OS(written in C), that is base for modern OSs</p>
<ul>
<li>it is required for BE, due to been base for MacOS and Linux, last been main server environment</li>
<li>Linux is not written on top of Unix, BUT it uses same philosophy (small and well done programs, that do one thing, embedded as modules and communicate via some standardized channel(ex: pipes)) and Unix compatible</li>
<li>Unix not only defines CLI utils, but OS file structure, permissions etc</li>
<li>programing languages can be Unix compatible too</li>
</ul>
<p>Unix shells - some application(process), often written in C, that can communicate with kernel via <code dir="auto">syscalls</code> to do some OS related work</p>
<ul>
<li>each shell have specific instruction set, that mapped onto syscalls</li>
<li>shell is base for any terminal(TTY)</li>
<li>examples:
<ul>
<li>sh - first Unix based shell
<ul>
<li>nowadays <code dir="auto">sh</code> is often just alias for <code dir="auto">bash</code></li>
</ul>
</li>
<li>bash - common go-to shell, if you work with Linux
<ul>
<li>it is basically a programing language</li>
</ul>
</li>
<li>zsh - bash compatible shell, with additional features
<ul>
<li>MacOS default shell</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>bash command execution flow:</p>
<ul>
<li>look for relevant alias (alias is alternative way to name command)</li>
<li>look for existing functions (custom, then built-in)</li>
<li>look at Path
<ul>
<li><code dir="auto">$PATH</code> is variable, that stores links to folders with executable applications, so any application stored there can be ran from any part of system by just running command</li>
<li><code dir="auto">PATH</code> is passed from parent process to child as copy, not by reference</li>
</ul>
</li>
</ul>
<p>file permissions - each file has 3 permissions(readable writable executable) in different combinations, that assigned to 3 groups of users(owner, owner’s group, other)</p>
<ul>
<li>can be changed by <code dir="auto">chmod</code></li>
<li>note that executable files will run in current shell, BUT, running <code dir="auto">bash ./script.sh</code>, will spawn child process with shell</li>
<li>file can’t be executable without been readable</li>
</ul>
<p>to pass functions, variables and aliases from one script to other bash allows using <code dir="auto">source</code>(OR alias <code dir="auto">.</code>) command, that will execute script and put everything to parent shell</p>
<p><code dir="auto">child_process</code> - module that used to manipulate processes in OS</p>
<ul>
<li><code dir="auto">spawn("process_name", ["args"])</code> - spawns child process with provided args
<ul>
<li>stream based</li>
<li>will only look at PATH, to find commands, so be careful with running built-in functions(but some of them can be listed in PATH) or aliases</li>
</ul>
</li>
<li><code dir="auto">exec("command")</code> - directly executes shell commands
<ul>
<li>basically it spawns child shell process and execute commands</li>
<li>can’t use streams</li>
</ul>
</li>
</ul>
<p>shell</p>
<ul>
<li>can be <code dir="auto">login</code> and <code dir="auto">non-login</code>, where first can run additional commands/scripts before running
<ul>
<li><code dir="auto">login</code> shell is slower</li>
</ul>
</li>
<li>can be <code dir="auto">interactive</code> and <code dir="auto">non-interactive</code>, where first can wait for user input, in-between executing commands</li>
<li>shell configs:
<ul>
<li>shell can run some default config files + file that can contain custom configs
<ul>
<li>custom config is often include: aliases, functions, env vars</li>
</ul>
</li>
<li>non-login + non-interactive - won’t run config</li>
<li>login - run default+custom config</li>
<li>non-login, interactive - run custom config</li>
</ul>
</li>
</ul>
<p>processes - every running thing in unix is process, that has some other process, with root been kernel itself</p>
<ul>
<li>each process has: PID(process ID), PPID(parent PID)</li>
<li>each process can start child process via syscall
<ul>
<li>this will pass parent’s envs to child, establish communication channel between them</li>
<li>note that killing parent not always will kill child, BUT such child will have some other process managing it afterwards, otherwise it must be killed</li>
</ul>
</li>
<li>all processes use RAM</li>
</ul>
<p>env var - some variable that is set on environment level and will be passed to child processes</p>
<ul>
<li>env var acts similarly to plain variable</li>
<li>can be created by <code dir="auto">export VAR_NAME</code> (should be uppercase by convention)</li>
<li>key for deployment and hiding some sensitive info</li>
</ul>
<p>file system - tree-like abstraction to manage data in Unix-compatible systems</p>
<ul>
<li>main dir is root (<code dir="auto">/</code>)
<ul>
<li><code dir="auto">/</code> is also acts as separator of entries</li>
</ul>
</li>
<li><code dir="auto">$HOME</code> - env var that references home dir path(<code dir="auto">/Users/yourUser</code>) and often aliased as <code dir="auto">~</code></li>
<li><code dir="auto">.</code> == current dir</li>
<li><code dir="auto">..</code> == prev directory (relatively)
<ul>
<li>to make path absolute it must start from <code dir="auto">/</code> and it will always redirect to specified place</li>
<li>be careful with relative paths in node, they will be calculated from where you call node process
<ul>
<li>to mitigate that you can use <code dir="auto">__dirname</code> OR <code dir="auto">import.meta.dirname</code> variable, that will always resolve in file’s dir</li>
</ul>
</li>
</ul>
</li>
<li>for better path management Node has <code dir="auto">path</code> package
<ul>
<li>it can work OS agnostic</li>
</ul>
</li>
<li><code dir="auto">$CDW</code> - env var that stores current working directory path</li>
</ul>
<p>data streams - streams that used to communicate between processes</p>
<ul>
<li>stdin (standard in) - stream that grabs input and directs it to process
<ul>
<li>by default stdin is connected to TTY, that proxies keyboard</li>
</ul>
</li>
<li>stdout (standard out) - stream that grabs output of process and directs it to other
<ul>
<li>commonly it is directed from process to TTY, that proxies it to monitor</li>
</ul>
</li>
<li>stderr (standard error) - same as stdout, but for data, that shouldn’t be saved</li>
<li>---</li>
<li>streams can be redirected from/to any process or even file
<ul>
<li>this can be configured in
<ul>
<li>Node, ex: console object can be created with custom stroud and stderr streams</li>
<li>Bash, ex: specify 0&#x3C;dest for stdin, 1>dest for stdout, 2>dest for stderr as param when launching process
<ul>
<li><code dir="auto">>dest</code> === <code dir="auto">1>dest</code></li>
<li><code dir="auto">&#x3C;dest</code> === <code dir="auto">0&#x3C;dest</code></li>
</ul>
</li>
</ul>
</li>
<li>note that all unix utils are configured to read from stdin and output to stdout</li>
</ul>
</li>
</ul>
<p>piping (<code dir="auto">|</code>) - take stdout of process 1 and attach it to stdin of process 2</p>
<ul>
<li>ignores stderr
redirection (<code dir="auto">></code>) - redirect stdin, stdout, stderr from/to some destination</li>
<li>you can redirect to void by specifying <code dir="auto">/dev/null</code> as dest</li>
<li>note that <code dir="auto">></code> will overwrite file, but <code dir="auto">>></code> will append</li>
</ul>
<p>alternative way (to pipes) for inner-process communication in Unix is using IPC (inter-process communication) via Unix Domain Sockets</p>
<ul>
<li>it is done via same <code dir="auto">net</code> module and has similar interface to TCP
<ul>
<li>instead of path+port we need to set <code dir="auto">path</code> to “file”
<ul>
<li>this “file” is communication channel between two app</li>
<li>note that this is not actual file, but rather some uniq id, like port
<ul>
<li>in unix everything is a file, BUT it is actually has socket type
<ul>
<li>like dir is a file, but with dir type</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>it can be easier to build more complex communication this way</li>
<li>you still can use TCP+localhost to communicate between processes, BUT it is less efficient this way
<ul>
<li>IPC can’t be use with internal machine, only inside single environment</li>
<li>IPC utilizes “shared” RAM, instead network card
<ul>
<li>note that Node doesn’t support pure shared memory by default</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>clustering - running same application multiple times in different physical cores</p>
<ul>
<li>by default, Node will run on single core and can’t be multithreaded</li>
<li>clustering is done via <code dir="auto">fork</code> sys call, that basically cloning itself as child process
<ul>
<li>Node includes standard <code dir="auto">cluster</code> lib to do so
<ul>
<li>it is built upon <code dir="auto">child_process.fork()</code>, which is special case of <code dir="auto">child_process.spawn()</code></li>
</ul>
</li>
<li>parent can <code dir="auto">fork</code> itself many times, do coordination(often it is it’s only task) and pass data via pipes between processes
<ul>
<li>to utilize resources fully, parent can <code dir="auto">fork</code> child process onto same core</li>
</ul>
</li>
<li>run <code dir="auto">fork</code> only from parent to avoid infinite loops (actually Node will just fail to execute <code dir="auto">fork</code> to prevent infinite loops)
<ul>
<li>can be checked via <code dir="auto">.isPrimary</code></li>
</ul>
</li>
<li>you can call <code dir="auto">fork</code> n times, where n is number of CPU cores you have(<code dir="auto">os.availableParallelism()</code>)</li>
</ul>
</li>
<li>note that Node.js allows to start multiple servers on same port via clustering
<ul>
<li>Node will bind single port to parent process AND this parent will distribute calls to child processes via round robin algorithm
<ul>
<li>it is recommended to do manual scheduling for heavy processes to avoid high loads</li>
</ul>
</li>
<li>this is primary usage of this module</li>
</ul>
</li>
<li>to share data between parent and child you can use <code dir="auto">worker.send(message)</code> and <code dir="auto">process.on("message", (message) => undefined)</code> OR <code dir="auto">process.send(message)</code> and <code dir="auto">cluster.on("message", (worker, message) => undefined)</code>
<ul>
<li><code dir="auto">send</code> will do serialization for you</li>
</ul>
</li>
<li>other events for <code dir="auto">cluster</code>: <code dir="auto">"fork"</code>, <code dir="auto">"listen"</code></li>
<li>for production you can use <code dir="auto">pm2</code> lib to do same stuff
<ul>
<li>you can run your app in cluster mode this way, BUT don’t have any additional control</li>
<li>also can be used to just run application in bg with additional monitoring</li>
</ul>
</li>
<li>avoid using cluster-only functions unconditionally</li>
</ul>
<p>npm - package manager, that can install and manage code from external source</p>
<p>ffmpeg - library to work with videos and images</p>
<ul>
<li>video - sequence of bites, that contains large amount of images(frames), audio(can be multiple) and some metadata
<ul>
<li>each media is encoded in specific way, ex: images === h.256, audio === AAC, metadata === UTF-8</li>
<li>extensions are just identifying container types for all of this data and correspond to some supported codex types, that they can contain inside</li>
<li>each media is called stream and can be changed independently from one-another</li>
</ul>
</li>
</ul>
<p>notes:</p>
<ul>
<li>in bash, process exits with some code, that signifies state(0 == executed successfully)
<ul>
<li>to read prev command exit code you can use <code dir="auto">$?</code></li>
</ul>
</li>
<li>bash allows to run processes in bg by specifying <code dir="auto">&#x26;</code> at the end of command</li>
<li>in Unix each process has a <code dir="auto">nice</code> value bound to it to determine resource usage priority
<ul>
<li>ranges:
<ul>
<li><code dir="auto">[-20, -1]</code> - system processes</li>
<li><code dir="auto">[0, 19]</code> - other processes, where <code dir="auto">0</code> is default value</li>
</ul>
</li>
<li>the lower the number - the higher the priority of process</li>
</ul>
</li>
<li>great Unix tools
<ul>
<li>ffmpeg - multimedia processing tool</li>
<li>imagemagick - image processing tool
<ul>
<li>alternative is <code dir="auto">npm/Jimp</code></li>
</ul>
</li>
<li>poppler - pdf processing tool</li>
<li>opencv - computer vision tool</li>
<li>whisper - speech to text</li>
</ul>
</li>
</ul>
<h4 id="compression">Compression</h4>
<p>Compression - encoding data in such way that original content is partially/fully preserved, but byte size is reduced</p>
<ul>
<li>great to reduce size of stored OR transferred information
<ul>
<li>remember that you need to label compressed files with compression type</li>
</ul>
</li>
<li>types:
<ul>
<li>lossless - no data is lost (main focus of this chapter)
<ul>
<li>in Node is done via <code dir="auto">zlib</code> module, that based on transform streams</li>
<li>types:
<ul>
<li>gzip - the most widely adopted algorithm in web, have great performance to compression percetage rate
<ul>
<li>optimized for text data</li>
<li>in Node: <code dir="auto">zlib.createGzip() &#x3C;=> zlib.createGunzip()</code></li>
</ul>
</li>
<li>brotli - often have better compression percentage rate, compared to gzip, BUT consumes more CPU power
<ul>
<li>can be used for different data types</li>
<li>focused on optimization of web resources, like CSS, JS etc</li>
<li>in Node: <code dir="auto">zlib.createBrotliCompressed() &#x3C;=> zlib.createBrotliDecompressed()</code></li>
</ul>
</li>
<li>deflate - base for gzip(gzip adds some additional metadata)
<ul>
<li>in Node: <code dir="auto">zlib.createDeflate() &#x3C;=> zlib.createInflate()</code></li>
<li>used in <code dir="auto">.zip</code></li>
</ul>
</li>
</ul>
</li>
<li>algorithms - single compression type can combine several compression algorithms for higher compression percentage (ex: Deflate itself is algorithm, that combines other algorithms)
<ul>
<li>Huffman Coding - probability based, because main idea is to find the most occurring thing and replace it with least amount of bytes
<ul>
<li>great for text encoding, because we already have character distribution data for all languages</li>
</ul>
</li>
<li>LZ - family of algorithms, that based on some principles
<ul>
<li>find repeating patterns, save first one, reference first one in other places
<ul>
<li>allows to configure <code dir="auto">windowSize</code>, that identifies how far from each other repeating patterns can occur</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>compressed files won’t reduce in size after second compression</li>
<li>popular formats:
<ul>
<li>PNG - lossless images</li>
<li>FLAC - lossless audio</li>
</ul>
</li>
</ul>
</li>
<li>lossy - some non-significant amount of data is lost, so it can’t be redone
<ul>
<li>doesn’t make sense to perform on text, BUT great for multimedia, because human eye can’t detect some details, thus they can be neglected</li>
<li>doesn’t natively supported in Node</li>
<li>often compressed files won’t reduce in size after second compression
<ul>
<li>OR it is not worse it, due to low size reduction</li>
</ul>
</li>
<li>popular formats:
<ul>
<li>JPEG - remove details from images, that human eye can’t see
<ul>
<li>mainly reduces coloring</li>
</ul>
</li>
<li>MP3 - audio compression</li>
<li>AAC - audio compression, better quality then MP3</li>
<li>H.264 - compresses all multimedia inside AND looks for static parts in-between frames to compress them in same way as LZ algorithms do by referencing</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>notes:
<ul>
<li>pre-compress static data AND do caching on compressed dynamic data, because compression is resource-heavy operation
<ul>
<li>it is often not really worse it to compress text-based responses</li>
<li>also it is not worse to compress small pieces of data</li>
</ul>
</li>
<li>remember about speed and compression ration trade-off
<ul>
<li>also time not always linear</li>
<li>each algorithm can be configured to different level of compression</li>
</ul>
</li>
<li>additionally you can specify file type, BUT often it can be autodetected</li>
</ul>
</li>
</ul>
<p>http</p>
<ul>
<li>in http world compression is done via including <code dir="auto">Accept-Encoding: ..., ...</code> header by client to indicate supported compression formats
<ul>
<li>usually done automatically by browser
<ul>
<li>same for decompression</li>
</ul>
</li>
<li>server can choose any compression AND, if any was chosen, it must respond with <code dir="auto">Content-Encoding: ...</code> header
<ul>
<li>note that <code dir="auto">Content-Length</code> must be of compressed data, but <code dir="auto">Content-Type</code> of original data AND compressing is done only on body, not headers</li>
<li>client can also compress request body and include <code dir="auto">Content-Encoding</code>, but it is not automatic AND generally avoided, because client doesn’t send too much data in general</li>
</ul>
</li>
</ul>
</li>
<li>usually compression+decompression is done via proxy OR middleware</li>
</ul>
<p>minification - “compression” technique for source code, where file size is reduced by introducing changes to code, that doesn’t change logic of program, BUT reduce file size</p>
<ul>
<li>remove whitespaces, remove comments, rename variables to shorter format</li>
<li>doesn’t work with binary data, BUT with text itself</li>
<li>great in combination with compression</li>
<li>can be compared with resizing in image optimization world</li>
</ul>
<p>notes:</p>
<ul>
<li>don’t compress sensitive data, like jwt tokens etc, because it is possible to do breach attack, where third-party can decrypt encrypted content, if it was compressed</li>
<li>avoid compressing small data AND already compressed data(ex: multimedia)</li>
<li>be careful with concurrent compressions, because Node allocates separate threads to do compression operations</li>
<li>gzip and brotli are doing checksum checks to preserve data integrity</li>
</ul>
<h4 id="multi-threading">Multi-Threading</h4>
<p>While Node is called single-threaded, it still can offload heavy operations to separate threads</p>
<ul>
<li>for this reason Node has threadpool, that is allocated to Node for any it’s needs</li>
<li>also Node allows to work with real kernel-level threads, do memory sharing and deadlock yourself ;)</li>
<li>the reason for “single-threaded” is because Node, by default, utilizes event-loop to manage concurrent actions, while other languages can utilize separate threads
<ul>
<li>also JS itself is single-threaded AND multi-threading in Node is fairly new concept, that can be done via worker-threads
<ul>
<li>alternative way of handling is by spawning child process, but it is more resource heavy operation to spawn process, because it still spawns thread under the hood, then to just spawn thread
<ul>
<li>also threads can share memory without kernel intervention</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Thread (same as process in Unix terminology) - unit of execution for process (single process can have one or more threads)</p>
<ul>
<li>thread can be in ready (waiting in queue to be executed by CPU), running(been executed by CPU) or sleep(waiting for something to happen) modes
<ul>
<li>there can be much more states, like: zombie state etc, BUT these are main once</li>
<li>dispatcher moves threads from ready to running</li>
<li>thread either finished OR moved back to queue after short time period
<ul>
<li>creates illusion of parallel execution(this illusion is called concurrent execution), even if CPU has single core
<ul>
<li>for multi-core CPUs, processes can be executed in true parallel manner
<ul>
<li>note that you don’t need to have physical cores, because on physical core can do two operations at a time, such sub-cores are called logical cores</li>
</ul>
</li>
</ul>
</li>
<li>thread is presented to CPU as instruction set, so it is easy to stop at some instruction AND continue later</li>
</ul>
</li>
<li>thread is moved to sleep state after doing blocking sys calls
<ul>
<li>after call is done, thread is moved back to queue</li>
<li>ex: when Node server process is listening on some port it is in sleep state, until some request comes in</li>
</ul>
</li>
</ul>
</li>
<li>adding threads to process allows to get more resources from CPU
<ul>
<li>this will allow to boost performance by N times, if operation can be done in chunks in parallel</li>
<li>you can prioritize some threads over others</li>
</ul>
</li>
</ul>
<p>Node</p>
<ul>
<li>in Node, all thread operations are done via <code dir="auto">worker_threads</code> module</li>
<li>Node allows to run files as separate threads, with separate event loop, context etc</li>
<li>threads are created in async, gradual manner (still faster then creating a process)
<ul>
<li>each thread occupies RAM
<ul>
<li>be careful with creating threads on request, this can DDOS your service</li>
</ul>
</li>
</ul>
</li>
<li>thread communication is done via <code dir="auto">MessageChannel</code>, that establishes communication channel between two ports</li>
<li>notes:
<ul>
<li>child thread can’t make main thread exit</li>
<li>child logs will go directly to parent thread
<ul>
<li>based on <code dir="auto">MessageChannel</code></li>
<li>blocked main thread will lead to missing logs</li>
</ul>
</li>
<li>there are other slight differences from main thread</li>
<li>threads often spawned in for loop</li>
<li>worker can spawn other workers</li>
<li>you can either spawn and terminate thread on each operation OR create a pool of threads, that will live in BG AND execute tasks on demand without additional overhead
<ul>
<li>Node.js has built in thread pool, that, by default, consists of 4 threads, for different tasks
<ul>
<li>only utilized by Node</li>
<li>utilized by Node only when syscal can’t be done in async manner (ex: <code dir="auto">fs</code>, <code dir="auto">crypto</code>, <code dir="auto">zlib</code> etc)
<ul>
<li>works only with async versions of functions</li>
</ul>
</li>
<li>be careful with creating too many Promises, Node will need to hold all of them in RAM, so better to constraint max number</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>CPU intensive vs I/O intensive vs Memory intensive operations</p>
<ul>
<li>CPU intensive - operation that takes large amount of CPU time</li>
<li>I/O intensive - operation that highly unitizes networking, file system etc to perform operation</li>
<li>Memory intensive - operation that takes large amount of RAM</li>
<li>Node itself can handle optimization of I/O operations out of the box AND you won’t see much benefit of multi-threading such operations, WHILE CPU intensive operations can be greatly optimized
<ul>
<li>only in Node world, in other languages you still might need to multi-thread your I/O operations
<ul>
<li>note that for small operations it might not be the case AND batching can help to utilize Node’s potential</li>
</ul>
</li>
</ul>
</li>
<li>Memory intensive might not give as much benefit, so better to be tested first</li>
</ul>
<p>shared memory</p>
<ul>
<li>by default, Node keeps memory of each thread independent and shares values between them as deep copies, BUT it is still possible to utilize it
<ul>
<li>thread concept helps here, because all threads share memory of single process, so no need to involve OS to do process communication and memory sharing</li>
</ul>
</li>
<li>Node only allows to share buffers, not actual objects
<ul>
<li>note that you can use <code dir="auto">Buffer</code> as abstraction on top of <code dir="auto">TypedArray</code>, that is abstraction on top of actual binary data, that is stored inside <code dir="auto">.buffer</code> as <code dir="auto">ArrayBuffer</code> or <code dir="auto">SharedArrayBuffer</code> and transferred this way
<ul>
<li>for sharing you need to use only <code dir="auto">SharedArrayBuffer</code></li>
<li>note that <code dir="auto">Buffer</code> abstraction can utilize pre-allocated pool of memory to store it’s data AND not allocate actual memory on flight</li>
<li><code dir="auto">Buffer</code> is always based on <code dir="auto">Uint8Array</code>, but you can also utilize other <code dir="auto">TypedArray</code>s</li>
</ul>
</li>
</ul>
</li>
<li>shared memory will always cause race condition problems that can be fixed with locks
<ul>
<li>also remember about deadlocks</li>
</ul>
</li>
<li>race conditions - cases, when several parallel operations try to modify shared resource, which leads to undetermined (based on timing of execution and final result is determined by last operation) behavior
<ul>
<li>places, that cause race conditions called critical sections</li>
<li>main mistake is to split read and write into separate operations</li>
<li>can happen in any concurrent environment, even in single-threaded cases</li>
<li>to concur race conditions you can utilize concept of atomic operations (operation that must complete fully and can’t be interrupted)
<ul>
<li>this is hardware level operations, provided by CPU and can be accessed via syscalls (or wrappers, like <code dir="auto">Atomics</code> in JS)</li>
<li>hardware guarantees such atomic property by both locking underlying values, when operation executes AND by never interrupting atomic operation</li>
<li>atomic operations always are simple once, to implement more complex things you need to utilize concept of mutual expression to enforce that some part of code OR resource can be used by only n(often 1) concurrent function at given point of type
<ul>
<li>mutual exclusion is built upon atomic operations</li>
<li>that simplest form is spinlock (block process, while other executes critical section)
<ul>
<li>in JS it can be implemented via <code dir="auto">Atomics.compareAndExchange</code></li>
<li>more complex is semaphore, which can have N simultaneous processes running AND makes other waiting processes not just blocked, but sleeping
<ul>
<li>if you have only two processes, this will be called binary semaphore AND if locking process does unlocking you will get a mutex</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>be careful with locks, because locking+unlocking in bad order OR forgetting to unlock will cause deadlock and make your application stuck
<ul>
<li>watch for order when working with multiple mutexes OR use single mutex instead of combining two of them</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>event loop - Node.js achieves async behavior via event loop concept and additional threads, that live in C++ world, while main program, written in JS is one single thread</p>
<ul>
<li>flow:
<ul>
<li>execute sync code(includes subscribing to async events and placing tasks into microtask queue)</li>
<li>empty-out nextTick &#x26; microtask queue
<ul>
<li><code dir="auto">Promise</code> results live in microtask queue</li>
<li>nextTicks are ran in same stage as microtasks, BUT always ran before them</li>
<li>each sub-queue will be executed in order of enqueuing</li>
<li>nextTick &#x26; microtask queue will always be emptied after each CB in CB queue is executed AND between each sub-cb queue</li>
</ul>
</li>
<li>setup event loop
<ul>
<li>creates set of callback queues to be executed in specific order
<ul>
<li>libuv pushes executed operations here</li>
<li>eventloop is running as long as we have subscriptions AND CBs in callback queues</li>
<li>each CB is executed one after another</li>
</ul>
</li>
<li>set of callbacks:
<ul>
<li>timers (<code dir="auto">setTimeout</code>, <code dir="auto">setInterval</code>)</li>
<li>poll (I/O operations)</li>
<li>check (<code dir="auto">setImmediate</code>)
<ul>
<li><code dir="auto">setImmediate</code> CB will always execute next after poll sub-queue is done, BUT it is not guaranteed to be executed next otherwise</li>
</ul>
</li>
</ul>
</li>
<li>not that CB queues aren’t guarantee ordering of enqueued operations</li>
</ul>
</li>
</ul>
</li>
<li>notes:
<ul>
<li><code dir="auto">async</code>/<code dir="auto">await</code> is syntactic sugar over callbacks, thus <code dir="auto">await</code> is not really blocking operation to our thread, it only blocks caller function flow of execution</li>
</ul>
</li>
</ul>
<p>notes:</p>
<ul>
<li>alway do monitoring and testing, because multi-threading is mentally challenging and high error risk area of programming</li>
<li>utilize threads to offload heavy OR background OR just blocking operations to separate thread and avoid slowing down or even blocking the main one</li>
<li>each thread will have <code dir="auto">Max((Cores / Blocking_Parallel_Threads) * 100%, 100%)</code> CPU usage
<ul>
<li>note that 100% comes not from all CPU, but from single core</li>
<li>to calculate this value more properly, you can use <code dir="auto">(total_time - total_idle_time) / total_time * 100%</code> (of activity per core) formula
<ul>
<li>to calculate total cpu utilization, just cal mean of all cores utilization</li>
</ul>
</li>
<li>if process has multiple threads, it will use more than 100%
<ul>
<li>for Mac and some Unix based machines, BUT it is also can be represented as % from total CPU usage</li>
</ul>
</li>
</ul>
</li>
<li>not all cores can have same performance</li>
<li>any operation, that can be ran in parallel, is great candidate to be ran in multi-threaded way</li>
<li>always do testing with extreme inputs to detect potential problems</li>
<li>you can profile if your main thread is blocked via <code dir="auto">performance.evenLoopUtilization()</code></li>
<li>multi-threading light weight operations can downgrade performance</li>
<li>when working with worker pool be aware that some requests can be executed pretty fast, so they can be executed on main thread and don’t be blocked by heavy tasks OR they can have separate queue OR they can be batched
<ul>
<li>using separate server for heavy tasks is also valid choice</li>
<li>this is also relevant to topic of blocking event loop</li>
<li>this can be used to DDOS your app</li>
</ul>
</li>
<li>it is often faster to do shared memory, rather then message passing (excluding cases, when there is too much overhead to do locking etc)</li>
<li>for CPU intensive operations it is almost always better to use C++, SO you can create Node addon, written in C++, and delegate all expensive compute to it, by imbedding it inside your Node app (with no limitations, unlike WebAssembly)
<ul>
<li>C++ app will ran as thread under Node process</li>
</ul>
</li>
</ul>
<h4 id="cryptography">Cryptography</h4>
<p>Basic concept of cryptography is to use some key to modify info in such way, that it can’t be understood without key, BUT could be reverted into original form with key</p>
<ul>
<li>key points
<ul>
<li>confidentiality - data can be accessible only by holder of key</li>
<li>integrity - content can’t be secretly modified</li>
<li>authentication - identity of content’s author must be confirmable</li>
</ul>
</li>
<li>cryptography ensures security and privacy of info and communication</li>
<li>for cryptography Node uses <code dir="auto">crypto</code>, <code dir="auto">tls</code> and <code dir="auto">https</code> modules
<ul>
<li>all of them are built upon <code dir="auto">openSSL</code></li>
</ul>
</li>
<li>encryption is unbreakable at the current moment</li>
</ul>
<p>symmetric encryption</p>
<ul>
<li>flow:
<ul>
<li>get original data, put it through Cipher(algorithm) with some private key and get encrypted data out</li>
<li>get encrypted data, put it through Cipher(algorithm) with used private key and get original data out</li>
</ul>
</li>
<li>common algorithms: AES (main), ChaCha (secondary), DES (deprecated main)</li>
<li>variants
<ul>
<li>One-Time Pad Encryption (OTP, often called perfect) - key is destroyed after usage
<ul>
<li>requirements: key length is data length, key is truly random, key used once and destroyed</li>
<li>based in XOR operation, where we set result to 0 for same bits and 1 for different once, which is <code dir="auto">^</code> operator in Node</li>
<li>this is more of a theoretical algorithm, because key management is problematic, due to need to securely pass key from one place to other before each data exchange AND due to key size
<ul>
<li>note that key can be used partially, but you always need to know message length</li>
</ul>
</li>
<li>flow: generate random key, exchange it between parties in secured manner, each message uses part of key via XOR to be encrypted, thus destroying it for one party to encrypt and other to decrypt</li>
<li>this is mathematically impossible to break due to basically missing a part of data</li>
<li>for small data, it might be faster to brute force then something like AES, BUT it is much harder to find original data, because potential results will look similar to original data</li>
</ul>
</li>
<li>AES
<ul>
<li>private key management is done via some other mechanisms, primally via asymmetric encryption</li>
<li>AES has different modes
<ul>
<li>ecb - concats each block one after other with no random present
<ul>
<li>highly insecure, because repeated data will be easily detectable</li>
<li>1 to 1 in size</li>
<li>fast and can run in parallel</li>
<li>if we corrupt some block, only it will be corrupted in final data</li>
</ul>
</li>
<li>cbc - uses result of previous block (or random data for first one) to XOR next before doing encryption, concats each block one after other
<ul>
<li>1 to 1 size + additional 128bits for random data
<ul>
<li>random data must be truly random and never reused</li>
<li>it can be sent as plaintext</li>
</ul>
</li>
<li>corruption of block will lead to its and next neighbor corruption</li>
<li>sequential only</li>
</ul>
</li>
<li>ctr - generate 128bit number (counter), that we gonna increment by 1 (starting from 0) for each block, encrypt it and XOR with block
<ul>
<li>1 to 1 size + additional 128bits for random data
<ul>
<li>it can be sent as plaintext</li>
</ul>
</li>
<li>attacker knows what data is been encrypted, BUT it still doesn’t have key, thus we are safe</li>
<li>if we corrupt some block, only it will be corrupted in final data</li>
<li>can run in parallel</li>
</ul>
</li>
<li>gcm (main) - ctr with additional message (MAC), that used to identify if original cipher was modified
<ul>
<li>it also allows to add additional verification data on top of key</li>
</ul>
</li>
</ul>
</li>
<li>notes:
<ul>
<li>key sizes can differ: (128, 196, 256) bits
<ul>
<li>defines repetitions: 10, 12, 14</li>
</ul>
</li>
<li>works on 128bits blocks of info
<ul>
<li>for each block: XOR with key, (do byte substitution, do byte shifting, do byte mixing, XOR with key) (repeated N times, without mixing at last step)
<ul>
<li>key here is 128 bit round key, that derived from original key through some math
<ul>
<li>it called round due to it is used only once per round</li>
</ul>
</li>
</ul>
</li>
<li>block can be padded with <code dir="auto">0x0f</code> to match size</li>
</ul>
</li>
<li>theoretically breakable AND might be bruteforced in distant future quantencomputers</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>hashing</p>
<ul>
<li>flow:
<ul>
<li>get original data of any size (message) -> pass through hash function (one way algorithm) -> receive fixed size output (hash, often 256 bites)</li>
</ul>
</li>
<li>properties:
<ul>
<li>process of hashing can’t be reversed</li>
<li>hashes of similar messages can’t be similar
<ul>
<li>in other words, it can’t be guessable</li>
</ul>
</li>
<li>number of hash collisions must be as low as possible (ideally 0)
<ul>
<li>SHA-256 collision is still not found</li>
</ul>
</li>
</ul>
</li>
<li>algorithms:
<ul>
<li>MD5 (broken), SHA family (SHA-1 (broken), SHA-n (256 is main), SHA3n, BLAKE2s256, BLAKE2b512)
<ul>
<li>often last number means number of bits in hash</li>
</ul>
</li>
</ul>
</li>
<li>some use-cases:
<ul>
<li>generate keys (with often strict length) from any data</li>
<li>ensure integrity of data by hashing it and transmitting hash alongside to verify if data wasn’t modified</li>
<li>password storage
<ul>
<li>don’t forget to salt your passwords to omit rainbow table attacks and reduce possibility of brute forcing passwords
<ul>
<li>if user have chosen simple password, you can make it harder to find with large salt</li>
<li>still, too small passwords are bruteforcable</li>
</ul>
</li>
</ul>
</li>
<li>HashMaps
<ul>
<li>it uses non-secure but, fast hashing function</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>message authentication codes - to prevent possibility of man in the middle attacks MACs can be used to verify data integrity, that transmitted over some channel</p>
<ul>
<li>flow: get cipher text, combine with encryption key and hash them together, the result should be send as second part of messages, after cipher text</li>
<li>algorithms: hmac (main)</li>
<li>Node has built in family of MAC algorithms inside <code dir="auto">crypto</code>
<ul>
<li>it is better to use built in algorithms, because just appending key with message is vulnerable with some algorithms, like SHA-n sub-family
<ul>
<li>it opens possibility to append to original data and have matching MACs</li>
<li>it is called length extension attack</li>
<li>algorithms like hmac are splitting key into two parts and pad message from both sides</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>key derivation functions - functions that help creating consistent random keys from input, that often comes as human-readable password</p>
<ul>
<li>flow: combine password with salt and do hashing N times to derive final result</li>
<li>algorithms: PBKFD2 (main), Scrypt (good for simple passwords), HKDF, Argon2</li>
<li>notes:
<ul>
<li>passwords can’t be stored, you need to store only key and corresponding salt (16+ bytes)</li>
<li>for longer keys that hashing algorithm can output we need to do each chunk of data separately</li>
</ul>
</li>
</ul>
<p>asymmetric (public-key) cryptography - process of data encryption and decryption, where pair of keys is used, one to encrypt and other to decrypt</p>
<ul>
<li>keys are related via math, but not identical</li>
<li>flow: generate key pairs, send public key to other party, received encrypted info from second party, decrypt via private key</li>
<li>most of time, asymmetric cryptography is used to exchange keys for doing symmetric cryptography, because last one is much faster</li>
<li>algorithms: RSA, DH (Deffie-Hellman), ECDH (Deffie-Hellman with Elliptic-curve)
<ul>
<li>RSA solves both exchange of symmetric keys problem AND authentication, that public keys belong to same person, BUT ECDH can be faster, so we can combine them</li>
<li>RSA algorithm:
<ul>
<li>generate 2 random primes, get modulus of both keys, calculate Phi of both keys, calculate public exponent (often 65537 used for speed and resource preservation), calculate private exponent from all previous data
<ul>
<li>we need to save modulus and public exponent in public space AND primes and private exponent in private space</li>
</ul>
</li>
<li>to break RSA you need to get modulus and find out two primes, that was used to calc it, BUT it is impossible, giving large enough primes</li>
<li>RSA add IV vector analog by default as part of input padding process</li>
<li>RSA has input size limitation</li>
</ul>
</li>
</ul>
</li>
<li>note:
<ul>
<li>both keys are basically ciphertexts with some information put inside of them
<ul>
<li>it can be viewed via tools like openssl</li>
<li>both keys contain large primer numbers, that co-linked between keys</li>
</ul>
</li>
<li>both keys can be used to reverse each others operation, they aren’t limited to just one action</li>
<li>key must generate party, that accepts data</li>
</ul>
</li>
</ul>
<p>digital signatures - process of signing (putting some data) OR verifying (checking that existing signature is vaid) for some data</p>
<ul>
<li>similar to signatures in real world, BUT with math ;)</li>
<li>flow: sign hash of data with private key, send your public key with signed hash(often appended to actual data), everyone can verify that data belongs to you via your public key</li>
<li>main problem is that you need to involve some third-party to verify that particular person owns particular public key
<ul>
<li>basically similar to how government enforces ownership of signatures</li>
</ul>
</li>
<li>the same concept is met in https, there you also have certificates, with certificate authorities, that guarantee validity of public keys in corresponding to domain names
<ul>
<li><code dir="auto">X.509</code> format is commonly used format
<ul>
<li>it is <code dir="auto">pem</code> file with some data: issuer, subject(server identity), public key, signature algorithm, issuer signature</li>
</ul>
</li>
<li>note that commonly used certificates come preinstalled on device, to omit man in the middle attacks, when doing initial exchange with issuer
<ul>
<li>this called root certificates, meaning certificates that was issued and signed by same subject (issuer == subject)</li>
<li>to check this list you can use <code dir="auto">tls.rootCertificates</code>
<ul>
<li>TLS is encrypted analog of TCP, which is used to make HTTP secure</li>
</ul>
</li>
</ul>
</li>
<li>certificates can be chained (often from 2 to 4)</li>
<li>authority verifies you by domain name via some DNS record
<ul>
<li>this means that almost all authorities doesn’t legally verify business or force them to comply with any rules, so HTTPS is only guarantees secure connection to server itself</li>
</ul>
</li>
</ul>
</li>
<li>to enable HTTPS in your server you need to have certificate, issued by root (or associated with it) authority
<ul>
<li>you can even set yourself as root inside your system and self-sign certificates
<ul>
<li>otherwise client will alert user, that connection can’t be verified and seems insecure</li>
</ul>
</li>
<li>to get certificate you first need to create request, that will be fulfilled by CA</li>
</ul>
</li>
</ul>
<p>TLS (Transport Layer Security) - most common protocol for establishing secure connections</p>
<ul>
<li>base for HTTPS (HTTP + TLS == HTTPS) and other “S” application layer protocols
<ul>
<li>in this schema TLS work between TCP and HTTP, so HTTP and all it’s content is encrypted</li>
<li>note that SSH is not built upon TLS, it is secure by itself</li>
</ul>
</li>
<li>TLS in Node.js can be used via <code dir="auto">tls</code> module and has similar functionality to <code dir="auto">net</code>, with additional security, that enforced by certificates, you need to provide, while using it
<ul>
<li><code dir="auto">tls</code> exposes additional events, that allow to differ secure and non-secure connections to server</li>
<li>TLS handshake is initiated by client, who asks for supported cipher and for communication in supported TLS version, after receiving it will verify cipher and tell server, that it is finished, after which server will agree, that handshake is finished
<ul>
<li>the result is that both entities are now have same public key</li>
<li>available versions of TLS: 1.1 (in progress of deprecation), 1.2, 1.3
<ul>
<li>1.3 doesn’t support RSA, because we have single private key for all transactions, which is less secure that Deffie-Hellman, where we have separate pairs per session, BUT it is faster while initial handshake</li>
</ul>
</li>
</ul>
</li>
<li>Node.js will use it’s own list of trusted CAs</li>
</ul>
</li>
<li>TLS can be ran in MTLS mode, which means mutual TLS, which is basically TLS, but both parties need to authenticate themselves</li>
<li>TLS can reuse previous sessions to reduce load</li>
</ul>
<p>key exchange protocol -</p>
<ul>
<li>flow: both client and server generates key pair and exchanges their public keys, after that shared secret is created by combining your own private key with party’s public key on both sides
<ul>
<li>result secrets are identical</li>
<li>client and server need to share prime and generator numbers, BUT they are public information and can be reused, to avoid re-computations</li>
</ul>
</li>
<li>main algorithm is Deffie-Hellman (but it is used with Elliptic Curve to reduce key sizes, while preserving security)
<ul>
<li>ECDH is not only more secure (if you get rid of keys after session ended), but also more performant then RSA(note that it is classified as key transport protocol)</li>
</ul>
</li>
<li>in TLS handshake client need to additionally send DH public key with it’s first request and server will respond with it’s DH public key
<ul>
<li>in this variation of TLS public key of certificate is used to verify signature from server (which includes client’s &#x26; server’s DH public keys with additional info) and not do actual key transport, thus client can verify that server’s DH public key is authentic
<ul>
<li>RSA signatures can be used here or swapped with algorithm from Elliptic Curve family to reduce key sizes AND speedup calculations of signatures</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>dictionary:</p>
<ul>
<li>plaintext - original data</li>
<li>ciphertext - encrypted data</li>
<li>encryption - conversion plaintext to ciphertext</li>
<li>decryption - conversion ciphertext to plaintext</li>
<li>cipher - algorithm for encryption and decryption</li>
</ul>
<p>notes:</p>
<ul>
<li>encryption universally works on binary data</li>
<li>http is transferred as plain text, thus you need https to prevent reading of transferred packets</li>
<li>encryption is lossless</li>
<li>JS’s <code dir="auto">Math.random</code> is not secure and can’t be used for cryptography</li>
<li>encryption must produce same data for same key and input
<ul>
<li>BUT, result of encryption can’t be guessable, based on similar inputs</li>
</ul>
</li>
<li>system is as secure as it’s weak part</li>
<li>good algorithm is not only secure, but must be efficient, easy to understand, have possibility to use hardware acceleration with it and be reasonable to use</li>
<li>never put secrets directly into code, BUT also don’t overuse env vars for this purpose, it is much better to use dedicated key management storage (KMS)</li>
<li>if you have connection to DB or just any other server, you must encrypt connection, to avoid information exposure to server provider
<ul>
<li>alternative is to use private network</li>
</ul>
</li>
</ul>
<h4 id="security">Security</h4>
<p>storing user password</p>
<ul>
<li>avoid:
<ul>
<li>plain text - compromise of DB will lead to password compromise</li>
<li>encrypting passwords - compromise of key will lead to password compromise</li>
<li>simple hashing - same passwords are prone to rainbow tables, weak passwords will result in weak hash</li>
</ul>
</li>
<li>proper way is to hash N (1kk is often good and optimized enough) times with additional salt (16bytes at min), that properly infused into password
<ul>
<li>ideally store metadata like iterations, key length, digest etc as part of password string OR in some relation to it
<ul>
<li>otherwise you need to ensure that they will never change</li>
</ul>
</li>
<li>salt always must be stored as part OR near the password</li>
</ul>
</li>
<li>password comparison must always take same amount of time to avoid timing attacks
<ul>
<li>Node.js expose API to compare buffers in same amount of time constantly</li>
</ul>
</li>
<li>alternatively just don’t store passwords and use oAuth</li>
<li>notes: Node.js has built in way to properly hash passwords, BUT it is easier to use some libs like argon2, that has better API and better algorithm underneath</li>
</ul>
<h2 id="asynclocalstorage">AsyncLocalStorage</h2>
<p>Current way of managing state and context is either directly passing it to function OR passing it via some property of a shared (example: request) object</p>
<ul>
<li>it is valid way, but can be restricting, complicated, introduce props drilling and prone to collisions</li>
<li>Node introduced built-in API to provide context in scope of <code dir="auto">async</code> operation life-cycle
<ul>
<li><code dir="auto">AsyncLocalStorage</code> comes from <code dir="auto">async_hooks</code> module and first need to be created, by providing initial value and value setter; creating is often done inside some middleware, thus enabling possibility for any related handler to get access to store
<ul>
<li>note that other requests must be called within setter fn</li>
</ul>
</li>
<li>avoid sharing context between handlers OR modifying it from unexpected places; keep context lightweight</li>
</ul>
</li>
</ul>
<h2 id="modern-nodejs-can-do-that">Modern Node.js Can Do That</h2>
<ul>
<li>Node can be ran in <code dir="auto">--watch</code> mode, without need for <code dir="auto">nodemon</code></li>
<li>Node can strip types, so simplified (at least no enums) TS support is enabled
<ul>
<li>it is possible to turn-on more complete subset of TS features too</li>
</ul>
</li>
<li>Node has built in <code dir="auto">sqlite</code> support</li>
<li>Node has built in testing framework</li>
<li>Node can inject envs via <code dir="auto">--env-file=.env</code> flag</li>
<li>Node allow to create temp files, similar to <code dir="auto">sessionStorage</code> and <code dir="auto">localStorage</code> to store semi-persistent info</li>
<li>Node has built-in <code dir="auto">glob</code> support as part of <code dir="auto">fs</code></li>
<li>Node has browser like WebSocket API (read-only)</li>
</ul>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">import</span><span style="--0:#D6DEEB;--1:#403F53"> { setTimeout } </span><span style="--0:#C792EA;--1:#8D46B4">from</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">node:timers/promises</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#C792EA;--1:#8D46B4">await</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">setTimeout</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#F78C6C;--1:#AA0982">100</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">string</span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#D6DEEB;--1:#403F53">);</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import { setTimeout } from &#x27;node:timers/promises&#x27;;await setTimeout(100, &#x27;string&#x27;);"><div></div></button></div></figure></div>
<h2 id="reference-architecture-by-red-hat">Reference Architecture by Red Hat</h2>
<p>Guide on how to create proper modern Node.js application, leveraging the power of npm</p>
<ul>
<li>having shared architecture makes development of large-scale apps and systems easier and faster</li>
<li>this architecture is just one possibility, not one fits all solutions</li>
</ul>
<h4 id="logging">Logging</h4>
<p>Proper logging makes it possible to understand and debug systems AND keep traceability hight</p>
<ul>
<li><code dir="auto">pino</code> - lightweight logger</li>
<li>structures logs as carriage-return separated JSON blocks, which is easy to parse, modify and search through</li>
<li>logs must be complete and contain all needed debug info</li>
<li>logs format must be consistent across the system</li>
<li>it might be useful to expose endpoint to configure logger dynamically</li>
<li>it must be possible to change or filter-out logs within the app</li>
<li>trace ids are great way to link all different services and parts of code into one transaction
<ul>
<li>it also should be exposed to customer, so support could re-use it for searching</li>
<li><code dir="auto">AsyncLocalStorage</code> can be useful here</li>
</ul>
</li>
<li>enrich logs with user data (not email, but id for GDPR) to enable actions logging</li>
<li>log proper IP and not something like loadbalancer’s IP</li>
<li>avoid logging sensitive data</li>
<li>print-out app configuration on startup (tools like <code dir="auto">convict</code> could help to omit logging sensitive configs)</li>
</ul>
<h4 id="code-consistency">Code Consistency</h4>
<p>Code must be consistent for better DX, faster onboarding AND to enable refactors</p>
<ul>
<li>consistency must be agreed on</li>
<li>consistency must be the same company-wise</li>
<li>automate as much as possible</li>
<li><code dir="auto">eslint</code> + <code dir="auto">prettier</code> are main choices
<ul>
<li>use pre-existing configs first</li>
<li>plugins and add-ons are available</li>
</ul>
</li>
<li><code dir="auto">eslint</code> must be automated:
<ul>
<li>IDE integration</li>
<li>on save</li>
<li>pre-commit (<code dir="auto">husky</code>)</li>
<li>CI/CD</li>
</ul>
</li>
<li>don’t forget to ignore <code dir="auto">node_modules</code></li>
</ul>
<h4 id="graphql">GraphQL</h4>
<p>GraphQL is powerful tool, that harder to setup than REST, but it might be beneficial in longer run</p>
<ul>
<li>agree on GraphQL Schema first (generating from resolvers is less stable, view schema as API contract)</li>
<li>cache, security and similar factors must be built differently, due to nature of GraphQL</li>
<li>keep schema generators and analyzers separate from consumer apps</li>
</ul>
<h4 id="containers">Containers</h4>
<p>Modern apps are containerized, backed into images and then this images get deployed to server</p>
<ul>
<li>good container is: small, secure (don’t run as root AND don’t use privileged ports), properly utilizes resources, debuggable (keep some tooling as part of image)</li>
<li>start with choosing well-known and well-supported base image, that is light weight, has OS and Node.js runtime</li>
<li>keep size small for efficiency by caching and doing multi-stage builds</li>
<li>keep builds fast by:
<ul>
<li>ignoring unneeded files</li>
<li>separating dependency image from main image to keep it stable</li>
</ul>
</li>
<li>limit Node’s memory usage to max available memory for container</li>
<li>container has poor handling of child_processes and zombies, so be careful with it
<ul>
<li>don’t use <code dir="auto">npm start</code>, this creates unnecessary npm process</li>
</ul>
</li>
</ul>
<h4 id="frameworks">Frameworks</h4>
<p>Generally use Express, BUT you might also benefit from other framework, that is less of a standard, so do your own research (check: weekly downloads, github starts, issues, number of commits, creation date, frequency of commits)</p>
<ul>
<li>look for stable, but maintainable solution, that wide-spread enough and had good enough docs</li>
</ul>
<h4 id="code-coverage">Code Coverage</h4>
<p>Coverage is metric, that helps verifying how much code is tested (it doesn’t always correlate with quality of tests, but it is important non the less)</p>
<ul>
<li>types:
<ul>
<li>functional - number of FNs called</li>
<li>statement - number of statements included in tests</li>
<li>path coverage - number of conditional flows covered</li>
<li>branch of decision - number of decision structures (ex: loop) covered</li>
</ul>
</li>
<li><code dir="auto">jest</code> and <code dir="auto">vitest</code> provide coverage reports</li>
<li>cover public API (contracts, expected behavior etc) first, than cover other behaviors of your application, from most to least critical</li>
<li>notes:
<ul>
<li>look not for hight coverage, but for proper tests, that cover all expected behaviors and break, when needed</li>
</ul>
</li>
</ul>
<h4 id="ts">TS</h4>
<p>TS addresses problem of weak types in JS with addition of some extra features</p>
<ul>
<li>it helps be more confident with changes AND have self-documented code</li>
<li>TS must be transpiled into JS via tools like <code dir="auto">tsc</code></li>
<li>TS need to be configured via <code dir="auto">tsconfig.json</code>
<ul>
<li>look for stricter configs on new projects</li>
</ul>
</li>
<li>TS allows for great autocompletes and refactoring via IDE</li>
<li>ship JS code, not TS that need to be transpiled
<ul>
<li>when shipping library add type declarations alongside JS code</li>
</ul>
</li>
</ul>
<h4 id="security-1">Security</h4>
<p>Code and application must be secure by design:</p>
<ul>
<li>dependencies
<ul>
<li>choose only needed once, it may be better not to use it</li>
<li>choose proper once</li>
<li>choose well maintained once</li>
<li>choose dependencies with well known dependencies of their own</li>
<li>don’t autoupdate</li>
<li>always fix <code dir="auto">audit</code> errors and warnings</li>
</ul>
</li>
<li>managing access
<ul>
<li>set 2fa as required authorization for your repos</li>
<li>use <code dir="auto">.ignore</code> files
<ul>
<li>manage secrets separately (<code dir="auto">dotenv</code> + passing envs via Docker is common combination, BUT you may also need some external vaults too)</li>
</ul>
</li>
<li>avoid mixing public and private npm packages inside single image, ideally build them separately</li>
</ul>
</li>
<li>write defensive code
<ul>
<li>avoid global state
<ul>
<li>never expose private info in it</li>
</ul>
</li>
<li>use <code dir="auto">NODE_ENV</code> as environment var, because it is standard way to communicate with underlying libraries about how much info should be exposed</li>
<li>validate user input (ideally both server and client, BUT server first)
<ul>
<li>remember about SQL injections and XSS</li>
</ul>
</li>
<li>handle errors properly
<ul>
<li>don’t expose too much details to client</li>
</ul>
</li>
<li>omit complex regexes (some regexes may be ok, BUT fail with some inputs, so be careful)
<ul>
<li>avoid ReDoS attacks</li>
</ul>
</li>
<li>expose only needed APIs via some prefix, like <code dir="auto">/api</code></li>
<li>integrate ACL and auth into most flows</li>
<li>share dependencies between projects in form of image
<ul>
<li>easier to update compromised dependencies</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="accessibility">Accessibility</h4>
<p>Accessibility is often a FE task, BUT CLI OR script accessibility and proper API is also important</p>
<ul>
<li>for CLI focus on providing good documentation, understandable outputs (ideally internationalized), proper colors and text sizes and multi-format output of some data (stdout, HTML, CSV etc)</li>
<li>for API satisfy FE requirements, this often means different formats of output (i18n, l10n, different formats) and proper error messages</li>
</ul>
<h4 id="dev-workflows">Dev workflows</h4>
<p>Different devs may use different tooling or workflow (due to preferences OR other factors)</p>
<ul>
<li>share knowledge</li>
<li>variations
<ul>
<li>zero install - fully cloud workspace with representation layer in form of laptop
<ul>
<li>low control on dev side and high dependency on maintainers of env</li>
</ul>
</li>
<li>local development - all code &#x26; dependencies are cloned locally, last one installed from config</li>
<li>local development with containers - all code &#x26; dependencies are cloned locally, dependencies are containerized and orchestrated</li>
<li>local development of some components - part of code is cloned locally in form of container, that can be ran with mocks (or dev env creds), other code and dependencies are containerized, orchestrated and can be accessible via shared environment</li>
<li>fully remote development wit containers - part of code is cloned locally, other code and dependencies are containerized, orchestrated and can be accessible via shared environment</li>
</ul>
</li>
<li>each variations has pros and cons and suitable for different sizes and types of apps
<ul>
<li>when moving from local to remote you lower complexity of development and testing, BUT development response loop drops</li>
</ul>
</li>
</ul>
<h4 id="npm-development">npm development</h4>
<ul>
<li>always init you package via <code dir="auto">npm init</code> and provide reasonable information (don’t forget about license and support)</li>
<li>include transpiled code and docs only
<ul>
<li>you can have several versions, like CJS or ESM</li>
<li>build on <code dir="auto">prePublish</code></li>
<li>generate type declarations if possible</li>
</ul>
</li>
<li>use different scripts, BUT omit <code dir="auto">postInstall</code> due to supply chain attack risks</li>
<li>dependencies
<ul>
<li>use <code dir="auto">package-lock.json</code> for proper versioning</li>
<li>pin dependencies</li>
<li>notes: <code dir="auto">^</code> will give higher minor and patch releases, <code dir="auto">~</code> will give every higher version in minor range</li>
</ul>
</li>
<li>use semantic versioning and conventional commits
<ul>
<li>you can even auto-update version by commit msgs via <code dir="auto">release-please</code> or <code dir="auto">standard-release</code></li>
</ul>
</li>
<li>use npm mirror for security, access/other restrictions, removing dependency on public registry</li>
</ul>
<h4 id="problem-determination">Problem determination</h4>
<p>Common problems: memory leaks, performance issues, unhandled failures, resource leak, network issues, system issues</p>
<ul>
<li>use metrics, logs, traces, core dumps, heap snapshots and alerts</li>
</ul>
<p>To determine the problem:</p>
<ul>
<li>match symptoms from different sources</li>
<li>confirm problem</li>
<li>gain additional info</li>
<li>rinse and repeat</li>
</ul>
<h4 id="testing">Testing</h4>
<p>Testing is important thing, that must be done and must be done properly</p>
<ul>
<li>use <code dir="auto">jest</code>, <code dir="auto">vitest</code> or <code dir="auto">mocha</code> (differs from <code dir="auto">jest</code> and <code dir="auto">vitest</code>, because it is unopinionated and only allow running tests with minimal infra)
<ul>
<li>from resent times, it is also possible to use Node.js built-in testing framework</li>
</ul>
</li>
<li>run tests against different Node versions (at least current and latest LTS)</li>
</ul>
<h4 id="transactions">Transactions</h4>
<p>Node has several ways to work with transactions:</p>
<ul>
<li>via DB transactions system and SQL <code dir="auto">BEGIN/COMMIT</code> syntax
<ul>
<li>don’t forget to <code dir="auto">ROLLBACK</code> transaction on failure</li>
</ul>
</li>
<li>for distributed systems you need to utilize patterns:
<ul>
<li>2 phase commit - reliable, but blocking operation</li>
<li>Saga pattern - async event-based pattern, that makes one service to wait for completion event from other, BUT it introduces complexity</li>
</ul>
</li>
</ul>
<h4 id="load-balancing-threading-and-scaling">Load balancing, threading, and scaling</h4>
<p>Some apps need more resources, here is how to satisfy them</p>
<ul>
<li>note that JS is single-threaded, not Node (due to native threads via <code dir="auto">worker_threads</code> OR by simple nature of microservices systems)</li>
<li>use threads for long running tasks, even if you have dedicated service for them, because you don’t won’t to block health etc</li>
<li>utilize scaling by container system, for simplicity, rather then Node’s API
<ul>
<li>keep your app stateless for load balancing and scaling</li>
</ul>
</li>
</ul>
<h4 id="cicd">CI/CD</h4>
<ul>
<li>use containers</li>
<li>use CI pipelines for code verification (lints, tests, builds etc) per PR</li>
<li>keep local, dev and prod envs similar
<ul>
<li>utilize dev envs as means for testing and verification</li>
<li>utulize blue/green releases for prod deployments</li>
</ul>
</li>
<li>keep your app configurable per env</li>
<li>add audit pipelines (per time cycle OR per PR)</li>
</ul> </div> <footer class="astro-3yyafb3n"> <div class="meta sl-flex astro-3yyafb3n">   </div> <div class="pagination-links astro-u2l5gyhi" dir="ltr"> <a href="/it_docs/all/management/" rel="prev" class="astro-u2l5gyhi"> <svg aria-hidden="true" class="astro-u2l5gyhi astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17 11H9.41l3.3-3.29a1.004 1.004 0 1 0-1.42-1.42l-5 5a1 1 0 0 0-.21.33 1 1 0 0 0 0 .76 1 1 0 0 0 .21.33l5 5a1.002 1.002 0 0 0 1.639-.325 1 1 0 0 0-.219-1.095L9.41 13H17a1 1 0 0 0 0-2Z"/></svg>  <span class="astro-u2l5gyhi"> Previous <br class="astro-u2l5gyhi"> <span class="link-title astro-u2l5gyhi">Management</span> </span> </a> <a href="/it_docs/all/optimization/" rel="next" class="astro-u2l5gyhi"> <svg aria-hidden="true" class="astro-u2l5gyhi astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17.92 11.62a1.001 1.001 0 0 0-.21-.33l-5-5a1.003 1.003 0 1 0-1.42 1.42l3.3 3.29H7a1 1 0 0 0 0 2h7.59l-3.3 3.29a1.002 1.002 0 0 0 .325 1.639 1 1 0 0 0 1.095-.219l5-5a1 1 0 0 0 .21-.33 1 1 0 0 0 0-.76Z"/></svg>  <span class="astro-u2l5gyhi"> Next <br class="astro-u2l5gyhi"> <span class="link-title astro-u2l5gyhi">Optimization</span> </span> </a> </div>  </footer>  </div> </div>   </main> </div> </div>  </div> </div>  </body></html>